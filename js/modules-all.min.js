/**!
 COMMONS
 All commons function merged to generics jQuery plugins

 @contributors: Geoffrey Crofte (Alsacréations)
 @date-created: 2015-03-26
 @last-update: 2015-03-26
 */

;
(function ($) {

	//
	// Plugin Name
	// @Description: Do something to create good interaction
	//

	$.fn.plugin_name = function (options) {

		var settings = $.extend({
			param_name: "param_value",
			param_name2: "param_value2"
		}, options);

		return this.each(function () {

		});

	};


	//
	// Toggle Slide
	// @Description: Toggle slide the targetted element
	// @Parameters: speed (int, ms)
	//

	$.fn.toggleSlide = function (options) {

		var settings = $.extend({
			speed: 200
		}, options);

		return this.each(function () {
			var $_this = $(this),
				$trigger = $(this).find('.js-toggle-trigger'),
				$target = $(this).find('.js-toggle-target');

			$trigger.on('click.ts', function () {

				if ($_this.hasClass('is-open')) {
					$target.stop().slideUp(settings.speed);
					$_this.removeClass('is-open');

				}
				else {
					$target.stop().slideDown(settings.speed);
					$_this.addClass('is-open');

				}

				return false;
			});
			$target.on('click.ts', function (e) {
				e.stopPropagation();
			});
			$('body').on('click', function (e) {
				if ($_this.hasClass('is-open')) {
					$trigger.trigger('click.ts');
				}
			});
		});

	};


	//
	// Toggle Fade
	// @Description: Toggle fade the targetted element
	// @Parameters: speed (int, ms)
	//

	$.fn.toggleFade = function (options) {

		var settings = $.extend({
			speed: 200
		}, options);

		return this.each(function () {
			var $_this = $(this),
				$trigger = $(this).find('.js-toggle-trigger'),
				$target = $(this).find('.js-toggle-target');

			$trigger.on('click.ts', function () {

				if ($_this.hasClass('is-visible')) {
					$target.stop().fadeIn(settings.speed);
					$_this.removeClass('is-visible');

				}
				else {
					$target.stop().fadeOut(settings.speed);
					$_this.addClass('is-visible');
				}

				return false;
			});
			$target.on('click.ts', function (e) {
				e.stopPropagation();
			});
		});

	};


}(jQuery));
/**!
 Add Calendar

 Make date of event clickeable for pop a menu for choose where to add the event in a calendar 

 @contributors: Guillaume Focheux (Alsacréations)
 @date-created: 2015-04-09
 @last-update: 2015-04-13
 */

;
(function ($) {
	;
	(function (exports) {
		var MS_IN_MINUTES = 60 * 1000;

		var formatTime = function (date) {
			return date.toISOString().replace(/-|:|\.\d+/g, '');
		};

		var calculateEndTime = function (event) {
			return event.end ?
				formatTime(event.end) :
				formatTime(new Date(event.start.getTime() + (event.duration * MS_IN_MINUTES)));
		};

		var calendarGenerators = {
			google: function (event) {
				var startTime = formatTime(event.start);
				var endTime = calculateEndTime(event);

				var href = encodeURI([
					'https://www.google.com/calendar/render',
					'?action=TEMPLATE',
					'&text=' + (event.title || ''),
					'&dates=' + (startTime || ''),
					'/' + (endTime || ''),
					'&details=' + (event.description || ''),
					'&location=' + (event.address || ''),
					'&sprop=&sprop=name:'
				].join(''));
				return '<a class="icon-google" target="_blank" href="' +
					href + '">Google Calendar</a>';
			},
			yahoo: function (event) {
				var eventDuration = event.end ?
					((event.end.getTime() - event.start.getTime()) / MS_IN_MINUTES) :
					event.duration;

				// Yahoo dates are crazy, we need to convert the duration from minutes to hh:mm
				var yahooHourDuration = eventDuration < 600 ?
					'0' + Math.floor((eventDuration / 60)) :
					Math.floor((eventDuration / 60)) + '';

				var yahooMinuteDuration = eventDuration % 60 < 10 ?
					'0' + eventDuration % 60 :
					eventDuration % 60 + '';

				var yahooEventDuration = yahooHourDuration + yahooMinuteDuration;

				// Remove timezone from event time
				var st = formatTime(new Date(event.start - (event.start.getTimezoneOffset() *
					MS_IN_MINUTES))) || '';

				var href = encodeURI([
					'http://calendar.yahoo.com/?v=60&view=d&type=20',
					'&title=' + (event.title || ''),
					'&st=' + st,
					'&dur=' + (yahooEventDuration || ''),
					'&desc=' + (event.description || ''),
					'&in_loc=' + (event.address || '')
				].join(''));

				return '<a class="icon-yahoo" target="_blank" href="' +
					href + '">Yahoo! Calendar</a>';
			},
			ics: function (event, eClass, calendarName) {
				var startTime = formatTime(event.start);
				var endTime = calculateEndTime(event);

				var href = encodeURI(
					'data:text/calendar;charset=utf8,' + [
						'BEGIN:VCALENDAR',
						'VERSION:2.0',
						'BEGIN:VEVENT',
						'URL:' + document.URL,
						'DTSTART:' + (startTime || ''),
						'DTEND:' + (endTime || ''),
						'SUMMARY:' + (event.title || ''),
						'DESCRIPTION:' + (event.description || ''),
						'LOCATION:' + (event.address || ''),
						'END:VEVENT',
						'END:VCALENDAR'].join('\n'));

				return '<a class="' + eClass + '" target="_blank" href="' +
					href + '">' + calendarName + ' Calendar</a>';
			},
			ical: function (event) {
				return this.ics(event, 'icon-ical', 'iCal');
			},
			outlook: function (event) {
				return this.ics(event, 'icon-outlook', 'Outlook');
			}
		};

		var generateCalendars = function (event) {
			return {
				google: calendarGenerators.google(event),
				yahoo: calendarGenerators.yahoo(event),
				ical: calendarGenerators.ical(event),
				outlook: calendarGenerators.outlook(event)
			};
		};


		// Make sure we have the necessary event data, such as start time and event duration
		var validParams = function (params) {
			return params.data !== undefined && params.data.start !== undefined &&
				(params.data.end !== undefined || params.data.duration !== undefined);
		};

		var generateMarkup = function (calendars, clazz, calendarId) {
			var resultHTML = document.createElement('div');

			res = '<label for="checkbox-for-' +
				calendarId + '" class="ac-switcher-label visually-hidden"></label>';
			res += '<input name="ac-switcher" class="ac-switcher" id="checkbox-for-' + calendarId + '" type="checkbox"><ul class="ac-list">';

			Object.keys(calendars).forEach(function (services) {
				res += '<li class="ac-item">' + calendars[services] + '</li>';
			});
			res += '</ul>';
			resultHTML.innerHTML = res;
			resultHTML.className = 'ac-add-to-calendar';
			if (clazz !== undefined) {
				resultHTML.className += (' ' + clazz);
			}

			resultHTML.id = calendarId;
			return resultHTML;
		};

		var getClass = function (params) {
			if (params.options && params.options.class) {
				return params.options.class;
			}
		};

		var getOrGenerateCalendarId = function (params) {
			return params.options && params.options.id ?
				params.options.id :
				Math.floor(Math.random() * 1000000); // Generate a 6-digit random ID
		};

		exports.createCalendar = function (params) {
			if (!validParams(params)) {
				console.log('Event details missing.');
				return;
			}

			return generateMarkup(generateCalendars(params.data),
				getClass(params),
				getOrGenerateCalendarId(params));
		};
	})(this);

	// get Zone addcalendar
	var $addCal = $('.js-add-to-calendar'),
		$the_event = $('[itemtype="http://schema.org/Event"]'),
		$remoteTrigger = $('.ac-js-switcher-remote');
	// get event information
	$startDate = $('meta[itemprop="startDate"]', $the_event).attr('content'),
		$endDate = $('meta[itemprop="endDate"]', $the_event).attr('content'),
		eventAddress = $('[itemprop="addressLocality"]')[0].innerHTML + ' ' + $('.sb-place-spot')[0].innerHTML + ' ' + $('.sb-place-country')[0].innerHTML;

	// generate HTML for calendar
	var myCalendar = createCalendar({
		data: {
			title: $('[itemprop="name"]', $the_event).attr('content'), // Event title
			start: new Date($startDate), // Event start date
			duration: 0, // Event duration (IN MINUTES)
			end: new Date($endDate), // You can also choose to set an end time.
			// If an end time is set, this will take precedence over duration
			address: eventAddress
		}
	});

	// add HTML and events to page
	$addCal.append(myCalendar);
	$remoteTrigger.on('click', function (e) {
		$addCal.find('.ac-switcher-label').trigger('click');
		e.stopPropagation();
	});
	$('body').off('click.acswitcher').on('click.acswitcher', function() {
	  $('.ac-switcher').prop('checked',false);
	});

})(jQuery);

/**!
	Corporate Navigation
	Dropdown menu & Mega menu navigation

	@contributors: Geoffrey Crofte (Alsacréations)
	@date-created: 2015-04-01
	@last-update: 2015-05-28
 */

;(function($) {

	var $menuline = $('.mn-menu-line'),
		$menu = $('.mn-menu'),
		$submenus = $menu.find('.mn-item-has-megamenu, .mn-item-has-submenu'),
		speed = 175,
		menuInitPos = $menuline.offset(),
		scrolltimer;

	// actions on mouse interactions
	$submenus.on('mouseenter.megamenu', function(e){
			$(this).addClass('is-open')
				.find('> .mn-sub-menu-mega, > .mn-sub-menu').stop().fadeIn(speed);
		})
		.on('mouseleave.megamenu', function(e){
			$(this).removeClass('is-open')
				.find('> .mn-sub-menu-mega, > .mn-sub-menu').stop().fadeOut(speed);
		});

	// accessibility (keyboard tab nav)
	$submenus.find('> .mn-link').on('focus', function(){
		$(this).closest('.mn-menu-item').trigger('mouseenter');
	});
	$submenus.find('a:last').on('blur', function(){
		$(this).closest('.mn-item-lvl-1').trigger('mouseleave');
	});

	// sticky things on scroll
	window.addEventListener('scroll', function(){
		clearTimeout(scrolltimer);
		scrolltimer = setTimeout(function(){

			if ( $(window).scrollTop() >= menuInitPos.top) {
				$menuline.closest('.site-banner').addClass('is-stuck');
			}
			else {
				$menuline.closest('.site-banner').removeClass('is-stuck');
			}

		}, 15);
	}, true);

})(jQuery);

/**!
 Datepicker
 Datepicker module with Pikaday

 @contributors: Rodolphe (Alsacréations)
 @date-created: 2015-06-12
 */

(function($) {

  $.cxpDatepicker = function(el, options) {

    var defaults = {};

    var plugin = this;

    plugin.settings = {};

    var $element = $(el),
      element = el;

    // Plugin initialization
    plugin.init = function() {
      plugin.settings = $.extend({}, defaults, options);
      updateSettingsFromHTMLData();
      registerEvents();
    };

    // Reads plugin settings from HTML data-* attributes (camelCase)
    var updateSettingsFromHTMLData = function() {
      var data = $element.data();
      for (var dat in data) plugin.settings[dat] = data[dat];
    };

    // Event Handlers on HTML components inside the plugin
    var registerEvents = function() {
      $element.on('click', false); // preventDefault in <input type="date">
      plugin.settings.picker = new Pikaday({
        field: element,
        format: 'DD/MM/YYYY',
      });
      $element.next('.btn-datepiker').on('click', function() {
        plugin.settings.picker.show();
      });
    };

    plugin.init();

  };

  $.fn.cxpDatepicker = function(options) {

    return this.each(function() {
      if (undefined === $(this).data('cxpDatepicker')) {
        var plugin = new $.cxpDatepicker(this, options);
        $(this).data('cxpDatepicker', plugin);
      }
    });

  };

  $('.cxp-datepicker').cxpDatepicker();

})(jQuery);

/**!
 Linked form items
 Linked form items module

 @contributors: Rodolphe (Alsacréations)
 @date-created: 2015-04-28
 @last-update: 2015-04-28
 */

(function($) {

   $.cxpFormlink = function(el, options) {

      var defaults = {
        target:null, // target element to toggle
      };

      var plugin = this;

      plugin.settings = {};

      var $element = $(el),
          element = el;

      // Plugin initialization
      plugin.init = function() {
         plugin.settings = $.extend({}, defaults, options);
         updateSettingsFromHTMLData();
         // Hide target element is source element is not checked
         if(plugin.settings.target!==null) {
           if(!$element.is(':checked')) $(plugin.settings.target).hide();
         }
         registerEvents();
      };

      // Reads plugin settings from HTML data-* attributes (camelCase)
      var updateSettingsFromHTMLData = function() {
         var data = $element.data();
         for(var dat in data) plugin.settings[dat] = data[dat];
      };

      // Event Handlers on HTML components inside the plugin
      var registerEvents = function() {
        $element.on('click', function() {
          $(plugin.settings.target).toggle($element.is(':checked'));
        });
      };

      plugin.init();

   };

   $.fn.cxpFormlink = function(options) {

       return this.each(function() {
           if (undefined === $(this).data('cxpFormlink')) {
               var plugin = new $.cxpFormlink(this, options);
               $(this).data('cxpFormlink', plugin);
           }
       });

   };

   $('.cxp-formlink').cxpFormlink();

 })(jQuery);

/**!
 Gallery Slider
 Description du module

 @contributors: Guillaume Focheux (Alsacréations)
 @date-created: 2015-04-28
 @last-update: 2015-04-29
 */

;(function ($) {

	setTimeout(function () {
		var $galInfinite = $("#gallery-infinite");


		$galInfinite.infinitescroll({
			navSelector: '#galinfnav', // selector for the paged navigation
			nextSelector: '#galinfnav a', // selector for the NEXT link (to page 2)
			itemSelector: '.gal-item', // selector for all items you'll retrieve
			animate: true,
			debug: false,
			loading: {
				speed: 0,
				selector: '.loading',
			    msgText:"<div class=\"loading-inner\"><span class=\"shape\"></span><span class=\"shape\"></span><span class=\"shape\"></span></div>"+
				"<p class=\"loading-txt\">Chargement en cours, merci de patienter</p>"
			}
		},
		// trigger Masonry as a callback
		function (newElements) {
			// hide new items while they are loading
			var $newElems = $(newElements).css({opacity: 0});
			// ensure that images load before adding to masonry layout
			$newElems.imagesLoaded(function () {
				// show elems now they're ready
				$newElems.animate({opacity: 1});
				$galInfinite.masonry('appended', $newElems, true);
			});
		}
		);
	}, 500);


})(jQuery);

/**!
 Gallery Slider
 Description du module

 @contributors: Guillaume Focheux (Alsacréations)
 @date-created: 2015-04-28
 @last-update: 2015-04-29
 */

;
(function ($) {

	function appendGallerySlider($elem, $gallerySlider) {
		var tplGallerySlider = '<div class="gal-item gal-js-item slider-item"> ' +
		'   <img class="gal-item-img" src="{{img-src}}" width="{{img-width}}" height="{{img-height}}" alt="{{img-alt}}">' +
		'   <div class="gal-item-content">' +
		'	<p class="gal-item-copy">&copy;{{img-copy}}</p>' +
		'	<h2 class="gal-item-title"><a href="#">{{img-title}}</a></h2>' +
		'	<p class="gal-item-desc">{{img-desc}}</p>' +
		'   </div>' +
		'</div>';
		//var $sliderWrapper = $gallerySlider.find('.slider-content');


		tplGallerySlider = tplGallerySlider.replace('{{img-src}}', $elem.data('imgSrc'));
		tplGallerySlider = tplGallerySlider.replace('{{img-alt}}', $elem.data('imgAlt'));
		tplGallerySlider = tplGallerySlider.replace('{{img-width}}', $elem.data('imgWidth'));
		tplGallerySlider = tplGallerySlider.replace('{{img-height}}', $elem.data('imgHeight'));
		tplGallerySlider = tplGallerySlider.replace('{{img-title}}', $elem.data('imgTitle'));
		tplGallerySlider = tplGallerySlider.replace('{{img-desc}}', $elem.data('imgDesc'));
		tplGallerySlider = tplGallerySlider.replace('{{img-copy}}', $elem.data('imgCopy'));
		return tplGallerySlider;
	}

	// empty slider's content and inject new one
	function updateGallerySlider(e) {
		var $gallery = $(this).parents('.gallery-js'), //gallery
		indexSelected = $(this).parents('.gal-js-item').index(), // index selected
		$gallerySlider = $('' + $gallery.data('slider')), // jQuery Object
		htmlToAppend = ''; // var with html to add
		var $gallerySwiper = $gallerySlider.data('swiper'); // swiper Object

		$gallerySwiper.removeAllSlides();
		//$('.slider-item', $gallerySlider).remove(); // remove all slide
		$gallery.children('.gal-js-item').each(function () {
			//htmlToAppend += appendGallerySlider($(this), $gallerySlider);
			$gallerySwiper.appendSlide(appendGallerySlider($(this), $gallerySlider));
		});
		//$gallerySlider.find('.slider-content').append(htmlToAppend);
		// Update Pagination number
		$gallerySlider.find('.slider-nb-total').text($gallerySlider.find('.slider-item').length);
		$gallerySlider.find('.slider-nb-start').text(indexSelected + 1).attr('data-nbfrom', indexSelected + 1);

		if (!$gallerySwiper.slideTo(indexSelected)) {
			setTimeout(function () {
				$gallerySwiper.slideTo(indexSelected);
			}, 500);
		}
		e.preventDefault();
	}

	$('.gallery-js').on('click', '.gal-js-item-link', updateGallerySlider);

})(jQuery);

/**!
 Gallery Slider
 Description du module

 @contributors: Guillaume Focheux (Alsacréations)
 @date-created: 2015-04-28
 @last-update: 2015-04-29
 */

;
(function($) {

    $.cxpGallerySwiper = function(el, options) {

        var defaults = {
            surveyPostUrl: '' // URL to post results
        };

        var plugin = this;

        plugin.settings = {};

        var $element = $(el),
            element = el;

        // Plugin initialization
        plugin.init = function() {
            plugin.settings = $.extend({}, defaults, options);
            updateSettingsFromHTMLData();
            registerEvents();
        };

        // Reads plugin settings from HTML data-* attributes (camelCase)
        var updateSettingsFromHTMLData = function() {
            var data = $element.data();
            for (var dat in data) plugin.settings[dat] = data[dat];
        };

        // Event Handlers on HTML components inside the plugin
        var registerEvents = function() {
            $element.on('click', '.gal-js-item-link', plugin.updateGallerySlider);
        };

        // Update the gallery slider
        plugin.updateGallerySlider = function(e) {

            var indexSelected = $(this).closest('.gal-js-item').index();
            var $swiper = $($element.data('swiper'));
            var cxpSwiper = $swiper.data('cxpSwiper');

            // Clear swiper content
            if (cxpSwiper) cxpSwiper.destroy();
            $('.swiper-wrapper', $swiper).empty();

            $element.children('.gal-js-item').each(function() {
                $('.swiper-wrapper', $swiper).append(plugin.generateSlide($(this)));
            });

            // Reinit swiper
            $swiper.cxpSwiper();

            setTimeout(function() { // Hack for null position
                if (indexSelected > 0) $swiper.data('cxpSwiper').goTo(indexSelected);
            }, 25);


            if ($swiper.data('resize') == 1) {
                $('.swiper-wrapper', $swiper).find('.gal-item-img').each(function(e){
                    $(this).hide();
                    $(this).load(plugin.resizeImg);
                    $(this).fadeIn(500);
                    });
            }
            e.preventDefault();
        };

        // resize all Image
        plugin.resizeImg = function() {
            var $img = $(this),
                $modal = $(this).closest('.gal-modal'),
                modalHeight = $modal.height() - parseInt($img.css('marginTop')),
                modalWidth = $modal.width(),
                imgHeight = $img[0].naturalHeight,
                imgWidth = $img[0].naturalWidth,
                contentHeight = $(this).closest('.gal-item').find('.gal-item-content').innerHeight(),
                $content = $(this).closest('.gal-item').find('.gal-item-content').first(),
                contentTop = $content.position().top,
                imgMaxHeight = modalHeight;
            if ($(this).closest('.gal-item').find('.gal-item-content').css('position') != 'absolute') {
                var contentAdditionHeight = 0;
                $(this).closest('.gal-item').find('.gal-item-content').find('> *').each(function() {
                    contentAdditionHeight += $(this).outerHeight();
                });
                contentHeight = contentHeight + contentAdditionHeight;
                imgMaxHeight = modalHeight - contentHeight;
            }
            // console.log('imgMaxHeight : ' + imgMaxHeight);
            // console.log('imgHeight : ' + imgHeight);
            // console.log('imgWidth : ' + imgWidth);
            // console.log('modalWidth : ' + modalWidth);

            var newHeight = 0,
                newWitdh = 0,
                ratio = 1;

            if (imgMaxHeight < imgHeight) {
                newHeight = imgMaxHeight;
                ratio = imgMaxHeight / imgHeight;
                newWidth = imgWidth * ratio;
                // Adjust for width too large
                if (newWidth > modalWidth) {
                    newHeight = (modalWidth / newWidth) * newHeight;
                    newWidth = modalWidth;
                }

            } else if (imgWidth >= modalWidth) {
                newHeight = (modalWidth / imgWidth) * imgHeight;
                newWidth = modalWidth;
                // Adjust for width too large
                if (newHeight > imgMaxHeight) {
                    newWidth = (imgMaxHeight / imgHeight) * newWidth;
                    newHeightWidth = modalHeight;
                }
            } else {
                newWidth = imgWidth;
                newHeight = imgHeight;
            }
            //console.log('h/w :'+ imgHeight + '/' + imgWidth + ' | new h/w :' + newHeight + '/' + newWidth);

            if( newHeight > newWidth ){
                $img.closest('.gal-item').addClass('portrait-mode');
            } else {
                $img.closest('.gal-item').addClass('landscape-mode');
            }

            $img.height(newHeight);
            $img.width(newWidth);
            $img.margin = 'auto';
        };

        plugin.generateSlide = function($elem) {
            var tplGallerySlider = '<div class="gal-item gal-js-item slider-item"> ' +
                '   <div class="gal-item-illust"><img class="gal-item-img" src="{{img-src}}" width="{{img-width}}" height="{{img-height}}" alt="{{img-alt}}"></div>' +
                '   <div class="gal-item-content">' +
                '	<p class="gal-item-copy">&copy;{{img-copy}}</p>' +
                '	<h2 class="gal-item-title"><a href="#">{{img-title}}</a></h2>' +
                '	<p class="gal-item-desc">{{img-desc}}</p>' +
                '   </div>' +
                '</div>';

            tplGallerySlider = tplGallerySlider.replace('{{img-src}}', $elem.data('imgSrc'));
            tplGallerySlider = tplGallerySlider.replace('{{img-alt}}', $elem.data('imgAlt'));
            tplGallerySlider = tplGallerySlider.replace('{{img-width}}', $elem.data('imgWidth'));
            tplGallerySlider = tplGallerySlider.replace('{{img-height}}', $elem.data('imgHeight'));
            tplGallerySlider = tplGallerySlider.replace('{{img-title}}', $elem.data('imgTitle'));
            tplGallerySlider = tplGallerySlider.replace('{{img-desc}}', $elem.data('imgDesc'));
            tplGallerySlider = tplGallerySlider.replace('{{img-copy}}', $elem.data('imgCopy'));
            return tplGallerySlider;
        };

        plugin.init();

    };

    $.fn.cxpGallerySwiper = function(options) {

        return this.each(function() {
            if (undefined === $(this).data('cxpGallerySwiper')) {
                var plugin = new $.cxpGallerySwiper(this, options);
                $(this).data('cxpGallerySwiper', plugin);
            }
        });

    };

    $('.gallery-js').cxpGallerySwiper();

})(jQuery);

/**!
 Gallery
 Description du module

 @contributors: Guillaume Focheux (Alsacréations)
 @date-created: 2015-04-28
 @last-update: 2015-04-29
 */

;
(function($) {

  $.cxpGallery = function(el, options) {

    var defaults = {};

    var plugin = this;

    plugin.settings = {};

    var $element = $(el),
      element = el;

    // Plugin initialization
    plugin.init = function() {

      plugin.settings = $.extend({}, defaults, options);
      updateSettingsFromHTMLData();

      if ($element.length > 0) {
        if ($element.parents('body-corporate').length > 0) {
          $element.masonry({
            'itemSelector': '.gal-js-item'
          });
        } else {
          $element.masonry({
            'columnWidth': '.gal-item-simple',
            'itemSelector': '.gal-js-item',
            'percentPosition': true
          });
        }
      }

    };

    // Reads plugin settings from HTML data-* attributes (camelCase)
    var updateSettingsFromHTMLData = function() {
      var data = $element.data();
      for (var dat in data) plugin.settings[dat] = data[dat];
    };

    plugin.init();

  };

  $.fn.cxpGallery = function(options) {

    return this.each(function() {
      if (undefined === $(this).data('cxpGallery')) {
        var plugin = new $.cxpGallery(this, options);
        $(this).data('cxpGallery', plugin);
      }
    });

  };

  $('.gallery-js-masonry').cxpGallery();

})(jQuery);

/*!
 --------------------------------
 Infinite Scroll
 --------------------------------
 + https://github.com/paulirish/infinite-scroll
 + version 2.1.0
 + Copyright 2011/12 Paul Irish & Luke Shumard
 + Licensed under the MIT license

 + Documentation: http://infinite-scroll.com/
 */
;
(function(e) {
    if (typeof define === "function" && define.amd) {
        define(["jquery"], e)
    } else {
        e(jQuery)
    }
})(function(e, t) {
    "use strict";
    e.infinitescroll = function(n, r, i) {
        this.element = e(i);
        if (!this._create(n, r)) {
            this.failed = true
        }
    };
    e.infinitescroll.defaults = {
        loading: {
            finished: t,
            finishedMsg: "<em>Congratulations, you've reached the end of the internet.</em>",
            img: "data:image/gif;base64,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",
            msg: null,
            msgText: "<em>Loading the next set of posts...</em>",
            selector: null,
            speed: "fast",
            start: t
        },
        state: {
            isDuringAjax: false,
            isInvalidPage: false,
            isDestroyed: false,
            isDone: false,
            isPaused: false,
            isBeyondMaxPage: false,
            currPage: 1
        },
        debug: false,
        behavior: t,
        binder: e(window),
        nextSelector: "div.navigation a:first",
        navSelector: "div.navigation",
        contentSelector: null,
        extraScrollPx: 150,
        itemSelector: "div.post",
        animate: false,
        pathParse: t,
        dataType: "html",
        appendCallback: true,
        bufferPx: 40,
        errorCallback: function() {},
        infid: 0,
        pixelsFromNavToBottom: t,
        path: t,
        prefill: false,
        maxPage: t
    };
    e.infinitescroll.prototype = {
        _binding: function(n) {
            var r = this,
                i = r.options;
            i.v = "2.0b2.120520";
            if (!!i.behavior && this["_binding_" + i.behavior] !== t) {
                this["_binding_" + i.behavior].call(this);
                return
            }
            if (n !== "bind" && n !== "unbind") {
                this._debug("Binding value  " + n + " not valid");
                return false
            }
            if (n === "unbind") {
                this.options.binder.unbind("smartscroll.infscr." + r.options.infid)
            } else {
                this.options.binder[n]("smartscroll.infscr." + r.options.infid, function() {
                    r.scroll()
                })
            }
            this._debug("Binding", n)
        },
        _create: function(r, i) {
            var s = e.extend(true, {}, e.infinitescroll.defaults, r);
            this.options = s;
            var o = e(window);
            var u = this;
            if (!u._validate(r)) {
                return false
            }
            var a = e(s.nextSelector).attr("href");
            if (!a) {
                this._debug("Navigation selector not found");
                return false
            }
            s.path = s.path || this._determinepath(a);
            s.contentSelector = s.contentSelector || this.element;
            s.loading.selector = s.loading.selector || s.contentSelector;
            s.loading.msg = s.loading.msg || e('<div id="infscr-loading"><div>' + s.loading.msgText + "</div></div>");
            (new Image).src = s.loading.img;
            if (s.pixelsFromNavToBottom === t) {
                s.pixelsFromNavToBottom = e(document).height() - e(s.navSelector).offset().top;
                this._debug("pixelsFromNavToBottom: " + s.pixelsFromNavToBottom)
            }
            var f = this;
            s.loading.start = s.loading.start || function() {
                e(s.navSelector).hide();
                s.loading.msg.appendTo(s.loading.selector).show(s.loading.speed, e.proxy(function() {
                    this.beginAjax(s)
                }, f))
            };
            s.loading.finished = s.loading.finished || function() {
                if (!s.state.isBeyondMaxPage)
                    s.loading.msg.fadeOut(s.loading.speed)
            };
            s.callback = function(n, r, u) {
                if (!!s.behavior && n["_callback_" + s.behavior] !== t) {
                    n["_callback_" + s.behavior].call(e(s.contentSelector)[0], r, u)
                }
                if (i) {
                    i.call(e(s.contentSelector)[0], r, s, u)
                }
                if (s.prefill) {
                    o.bind("resize.infinite-scroll", n._prefill)
                }
            };
            if (r.debug) {
                if (Function.prototype.bind && (typeof console === "object" || typeof console === "function") && typeof console.log === "object") {
                    ["log", "info", "warn", "error", "assert", "dir", "clear", "profile", "profileEnd"].forEach(function(e) {
                        console[e] = this.call(console[e], console)
                    }, Function.prototype.bind)
                }
            }
            this._setup();
            if (s.prefill) {
                this._prefill()
            }
            return true
        },
        _prefill: function() {
            function i() {
                return e(n.options.contentSelector).height() <= r.height()
            }
            var n = this;
            var r = e(window);
            this._prefill = function() {
                if (i()) {
                    n.scroll()
                }
                r.bind("resize.infinite-scroll", function() {
                    if (i()) {
                        r.unbind("resize.infinite-scroll");
                        n.scroll()
                    }
                })
            };
            this._prefill()
        },
        _debug: function() {
            if (true !== this.options.debug) {
                return
            }
            if (typeof console !== "undefined" && typeof console.log === "function") {
                if (Array.prototype.slice.call(arguments).length === 1 && typeof Array.prototype.slice.call(arguments)[0] === "string") {
                    console.log(Array.prototype.slice.call(arguments).toString())
                } else {
                    console.log(Array.prototype.slice.call(arguments))
                }
            } else if (!Function.prototype.bind && typeof console !== "undefined" && typeof console.log === "object") {
                Function.prototype.call.call(console.log, console, Array.prototype.slice.call(arguments))
            }
        },
        _determinepath: function(n) {
            var r = this.options;
            if (!!r.behavior && this["_determinepath_" + r.behavior] !== t) {
                return this["_determinepath_" + r.behavior].call(this, n)
            }
            if (!!r.pathParse) {
                this._debug("pathParse manual");
                return r.pathParse(n, this.options.state.currPage + 1)
            } else if (n.match(/^(.*?)\b2\b(.*?$)/)) {
                n = n.match(/^(.*?)\b2\b(.*?$)/).slice(1)
            } else if (n.match(/^(.*?)2(.*?$)/)) {
                if (n.match(/^(.*?page=)2(\/.*|$)/)) {
                    n = n.match(/^(.*?page=)2(\/.*|$)/).slice(1);
                    return n
                }
                n = n.match(/^(.*?)2(.*?$)/).slice(1)
            } else {
                if (n.match(/^(.*?page=)1(\/.*|$)/)) {
                    n = n.match(/^(.*?page=)1(\/.*|$)/).slice(1);
                    return n
                } else {
                    this._debug("Sorry, we couldn't parse your Next (Previous Posts) URL. Verify your the css selector points to the correct A tag. If you still get this error: yell, scream, and kindly ask for help at infinite-scroll.com.");
                    r.state.isInvalidPage = true
                }
            }
            this._debug("determinePath", n);
            return n
        },
        _error: function(n) {
            var r = this.options;
            if (!!r.behavior && this["_error_" + r.behavior] !== t) {
                this["_error_" + r.behavior].call(this, n);
                return
            }
            if (n !== "destroy" && n !== "end") {
                n = "unknown"
            }
            this._debug("Error", n);
            if (n === "end" || r.state.isBeyondMaxPage) {
                this._showdonemsg()
            }
            r.state.isDone = true;
            r.state.currPage = 1;
            r.state.isPaused = false;
            r.state.isBeyondMaxPage = false;
            this._binding("unbind")
        },
        _loadcallback: function(r, i, s) {
            var o = this.options,
                u = this.options.callback,
                a = o.state.isDone ? "done" : !o.appendCallback ? "no-append" : "append",
                f;
            if (!!o.behavior && this["_loadcallback_" + o.behavior] !== t) {
                this["_loadcallback_" + o.behavior].call(this, r, i);
                return
            }
            switch (a) {
                case "done":
                    this._showdonemsg();
                    return false;
                case "no-append":
                    if (o.dataType === "html") {
                        i = "<div>" + i + "</div>";
                        i = e(i).find(o.itemSelector)
                    }
                    if (i.length === 0) {
                        return this._error("end")
                    }
                    break;
                case "append":
                    var l = r.children();
                    if (l.length === 0) {
                        return this._error("end")
                    }
                    f = document.createDocumentFragment();
                    while (r[0].firstChild) {
                        f.appendChild(r[0].firstChild)
                    }
                    this._debug("contentSelector", e(o.contentSelector)[0]);
                    e(o.contentSelector)[0].appendChild(f);
                    i = l.get();
                    break
            }
            o.loading.finished.call(e(o.contentSelector)[0], o);
            if (o.animate) {
                var c = e(window).scrollTop() + e(o.loading.msg).height() + o.extraScrollPx + "px";
                e("html,body").animate({
                    scrollTop: c
                }, 800, function() {
                    o.state.isDuringAjax = false
                })
            }
            if (!o.animate) {
                o.state.isDuringAjax = false
            }
            u(this, i, s);
            if (o.prefill) {
                this._prefill()
            }
        },
        _nearbottom: function() {
            var r = this.options,
                i = 0 + e(document).height() - r.binder.scrollTop() - e(window).height();
            if (!!r.behavior && this["_nearbottom_" + r.behavior] !== t) {
                return this["_nearbottom_" + r.behavior].call(this)
            }
            this._debug("math:", i, r.pixelsFromNavToBottom);
            return i - r.bufferPx < r.pixelsFromNavToBottom
        },
        _pausing: function(n) {
            var r = this.options;
            if (!!r.behavior && this["_pausing_" + r.behavior] !== t) {
                this["_pausing_" + r.behavior].call(this, n);
                return
            }
            if (n !== "pause" && n !== "resume" && n !== null) {
                this._debug("Invalid argument. Toggling pause value instead")
            }
            n = n && (n === "pause" || n === "resume") ? n : "toggle";
            switch (n) {
                case "pause":
                    r.state.isPaused = true;
                    break;
                case "resume":
                    r.state.isPaused = false;
                    break;
                case "toggle":
                    r.state.isPaused = !r.state.isPaused;
                    break
            }
            this._debug("Paused", r.state.isPaused);
            return false
        },
        _setup: function() {
            var n = this.options;
            if (!!n.behavior && this["_setup_" + n.behavior] !== t) {
                this["_setup_" + n.behavior].call(this);
                return
            }
            this._binding("bind");
            return false
        },
        _showdonemsg: function() {
            var r = this.options;
            if (!!r.behavior && this["_showdonemsg_" + r.behavior] !== t) {
                this["_showdonemsg_" + r.behavior].call(this);
                return
            }
            r.loading.msg.find("img").hide().parent().find("div").html(r.loading.finishedMsg).animate({
                opacity: 1
            }, 2e3, function() {
                e(this).parent().fadeOut(r.loading.speed)
            });
            r.errorCallback.call(e(r.contentSelector)[0], "done")
        },
        _validate: function(n) {
            for (var r in n) {
                if (r.indexOf && r.indexOf("Selector") > -1 && e(n[r]).length === 0) {
                    this._debug("Your " + r + " found no elements.");
                    return false
                }
            }
            return true
        },
        bind: function() {
            this._binding("bind")
        },
        destroy: function() {
            this.options.state.isDestroyed = true;
            this.options.loading.finished();
            return this._error("destroy")
        },
        pause: function() {
            this._pausing("pause")
        },
        resume: function() {
            this._pausing("resume")
        },
        beginAjax: function(r) {
            var i = this,
                s = r.path,
                o, u, a, f;
            r.state.currPage++;
            if (r.maxPage !== t && r.state.currPage > r.maxPage) {
                r.state.isBeyondMaxPage = true;
                this.destroy();
                return
            }
            o = e(r.contentSelector).is("table, tbody") ? e("<tbody/>") : e("<div/>");
            u = typeof s === "function" ? s(r.state.currPage) : s.join(r.state.currPage);
            i._debug("heading into ajax", u);
            a = r.dataType === "html" || r.dataType === "json" ? r.dataType : "html+callback";
            if (r.appendCallback && r.dataType === "html") {
                a += "+callback"
            }
            switch (a) {
                case "html+callback":
                    i._debug("Using HTML via .load() method");
                    o.load(u + " " + r.itemSelector, t, function(t) {
                        i._loadcallback(o, t, u)
                    });
                    break;
                case "html":
                    i._debug("Using " + a.toUpperCase() + " via $.ajax() method");
                    e.ajax({
                        url: u,
                        dataType: r.dataType,
                        complete: function(t, n) {
                            f = typeof t.isResolved !== "undefined" ? t.isResolved() : n === "success" || n === "notmodified";
                            if (f) {
                                i._loadcallback(o, t.responseText, u)
                            } else {
                                i._error("end")
                            }
                        }
                    });
                    break;
                case "json":
                    i._debug("Using " + a.toUpperCase() + " via $.ajax() method");
                    e.ajax({
                        dataType: "json",
                        type: "GET",
                        url: u,
                        success: function(e, n, s) {
                            f = typeof s.isResolved !== "undefined" ? s.isResolved() : n === "success" || n === "notmodified";
                            if (r.appendCallback) {
                                if (r.template !== t) {
                                    var a = r.template(e);
                                    o.append(a);
                                    if (f) {
                                        i._loadcallback(o, a)
                                    } else {
                                        i._error("end")
                                    }
                                } else {
                                    i._debug("template must be defined.");
                                    i._error("end")
                                }
                            } else {
                                if (f) {
                                    i._loadcallback(o, e, u)
                                } else {
                                    i._error("end")
                                }
                            }
                        },
                        error: function() {
                            i._debug("JSON ajax request failed.");
                            i._error("end")
                        }
                    });
                    break
            }
        },
        retrieve: function(r) {
            r = r || null;
            var i = this,
                s = i.options;
            if (!!s.behavior && this["retrieve_" + s.behavior] !== t) {
                this["retrieve_" + s.behavior].call(this, r);
                return
            }
            if (s.state.isDestroyed) {
                this._debug("Instance is destroyed");
                return false
            }
            s.state.isDuringAjax = true;
            s.loading.start.call(e(s.contentSelector)[0], s)
        },
        scroll: function() {
            var n = this.options,
                r = n.state;
            if (!!n.behavior && this["scroll_" + n.behavior] !== t) {
                this["scroll_" + n.behavior].call(this);
                return
            }
            if (r.isDuringAjax || r.isInvalidPage || r.isDone || r.isDestroyed || r.isPaused) {
                return
            }
            if (!this._nearbottom()) {
                return
            }
            this.retrieve()
        },
        toggle: function() {
            this._pausing()
        },
        unbind: function() {
            this._binding("unbind")
        },
        update: function(n) {
            if (e.isPlainObject(n)) {
                this.options = e.extend(true, this.options, n)
            }
        }
    };
    e.fn.infinitescroll = function(n, r) {
        var i = typeof n;
        switch (i) {
            case "string":
                var s = Array.prototype.slice.call(arguments, 1);
                this.each(function() {
                    var t = e.data(this, "infinitescroll");
                    if (!t) {
                        return false
                    }
                    if (!e.isFunction(t[n]) || n.charAt(0) === "_") {
                        return false
                    }
                    t[n].apply(t, s)
                });
                break;
            case "object":
                this.each(function() {
                    var t = e.data(this, "infinitescroll");
                    if (t) {
                        t.update(n)
                    } else {
                        t = new e.infinitescroll(n, r, this);
                        if (!t.failed) {
                            e.data(this, "infinitescroll", t)
                        }
                    }
                });
                break
        }
        return this
    };
    var n = e.event,
        r;
    n.special.smartscroll = {
        setup: function() {
            e(this).bind("scroll", n.special.smartscroll.handler)
        },
        teardown: function() {
            e(this).unbind("scroll", n.special.smartscroll.handler)
        },
        handler: function(t, n) {
            var i = this,
                s = arguments;
            t.type = "smartscroll";
            if (r) {
                clearTimeout(r)
            }
            r = setTimeout(function() {
                e(i).trigger("smartscroll", s)
            }, n === "execAsap" ? 0 : 100)
        }
    };
    e.fn.smartscroll = function(e) {
        return e ? this.bind("smartscroll", e) : this.trigger("smartscroll", ["execAsap"])
    }
});

/**!
	Lang Switcher
	Language selector usually included inside the site header

	@contributors: Geoffrey Crofte (Alsacréations)
	@date-created: 2015-04-01
	@last-update: 2015-04-01
 */
 
;(function($) {

	$('.js-lang-switcher').each(function(){

		var $_this = $(this);

		// button creation
		$_this.find('ul').before('<button class="ls-trigger js-toggle-trigger" type="button" title="'+$_this.data('title')+'">'+$_this.find('.is-active').text()+'</button>');

		// accessibility (tab nav)
		$_this.find('a:last').on('blur', function(){
			$_this.find('.js-toggle-trigger').trigger('click');
		});
	})
	.toggleSlide();

})(jQuery);
/**!
 Library
 Library module with Cart in local storage

 @contributors: Guillaume (Alsacréations)
 @date-created: 2015-05-20
 @last-update: 2015-05-21
 */

(function($) {

    $.cxpLibrary = function(el, options) {

        var defaults = {};
        var plugin = this;
        plugin.settings = {};
        var $element = $(el),
            element = el,
            lsPrefix = 'cxpCart_', //prefix for the localstorage
            id = $element.data('cartId'), //id for name the localstorage
            cart = {
                'folders': {},
                'items': {}
            }, //object Cart
            $modal = $('#modal' + id), //modal basket
            $modalPreview = $('#modalPreview' + id), //modal preview
            cxpStorage = localStorage, //Define storage type
            cartButton = $('[data-cart-id="' + id + '"]').find('.lb-js-btn'); // CartButton

        // Plugin initialization
        plugin.init = function() {
            plugin.settings = $.extend({}, defaults, options);
            plugin.lsGet();
            if ($element.find('.lb-js-folder').length > 0) {
                updateFoldersInfos();
            }
            if ($element.find('.lb-js-item').length > 0) {
                updateItemsInfos();
            }
            updateCartButton();
            updateTotalLength();
            registerEvents();

            return true;
        };
        // LocalStorage Action
        //get
        plugin.lsGet = function() {
            var cartRaw = cxpStorage.getItem(lsPrefix + id);
            if (cartRaw !== null) {
                cart = JSON.parse(cartRaw);
            } else {
                plugin.lsSet();
            }
        };
        //set
        plugin.lsSet = function() {
            var cartRaw = JSON.stringify(cart);
            cxpStorage.setItem(lsPrefix + id, cartRaw);
        };
        //remove
        plugin.lsRemove = function() {
            cxpStorage.removeItem(lsPrefix + id);
        };

        plugin.getLength = function(folder) {
            if (folder !== undefined) {
                if (cart.folders[folder] === undefined) {
                    return 0;
                }
                return Object.keys(cart.folders[folder]).length;
            } else {
                return Object.keys(cart.items).length;
            }
        };

        // UPDATE method
        var updateCartButton = function() {
            var nbItem = plugin.getLength();
            cartButton.removeClass('btn-invert').removeClass('btn-primary');
            if (nbItem > 0) {
                cartButton.attr('class', 'btn-primary ' + cartButton.attr('class'));
            } else {
                cartButton.attr('class', 'btn-invert ' + cartButton.attr('class'));
            }
            cartButton.find('.nb').text(nbItem);

            //Update length for the button inside modal
        };
        var updateFoldersInfos = function() {
            var $folders = $('.lb-js-folder');

            $folders.each(function() {
                var nbSelected = plugin.getLength($(this).data('folderId'));
                if (nbSelected > 0) {
                    $(this).find('.lb-list-link').addClass('is-selected');
                } else {
                    $(this).find('.lb-list-link').removeClass('is-selected');
                }
                $(this).find('.lb-list-infos').find('.nb').text(nbSelected);

            });

        };
        var updateItemsInfos = function() {
            var $items = $('.lb-js-item');
            $items.each(function() {
                if (cart.items[$(this).data('itemId')] !== undefined) {
                    $(this).find('.lb-js-item-checkbox').prop('checked', 'checked');
                    $(this).find('.lb-select-list-link').removeClass('is-checked').addClass('is-checked');
                } else {
                    $(this).find('.lb-js-item-checkbox').prop('checked', false);
                    $(this).find('.lb-select-list-link').removeClass('is-checked');
                }
            });

        };
        var updateTotalLength = function() {
            var TotalLength = 0;
            $.each(cart.items, function() {
                TotalLength += this.itemLength;
            });
            $modal.find('.lb-js-modal-download .lb-js-total').text(TotalLength);
        };
        // Event Handlers on HTML components inside the plugin
        var registerEvents = function() {
            //event check
            $element.on('click', '.lb-js-item-checkbox', plugin.itemAction);
            $element.on('click', '.lb-select-list-link', plugin.itemPreview);
            $element.on('click', '.lb-js-btn', plugin.regenModalAction);
            $modal.on('click', '.lb-js-modal-drop-all', plugin.resetCartAction);
            $modal.on('click', '.lb-js-modal-btn-drop-item', plugin.deleteFromCartAction);
        };
        // Actions

        //Update modal's content (folder and item)
        plugin.regenModalAction = function(e) {
            var nbItem = plugin.getLength(),
                $modalContent = $modal.find('.lb-js-modal-content'),
                $template = $('#tpl-lb-js-modal-content').html();
            var cft = plugin.prepareCartForTemplate(); //Cart For Template
            if (nbItem > 0) {
                $('.lb-js-modal-drop-all').show();
                $('.lb-js-modal-download').show();
                $modalContent.html($.mustache($template, cft));
            } else {
                $('.lb-js-modal-drop-all').hide();
                $('.lb-js-modal-download').hide();
                $('.lb-js-modal-content').html('<p>Le panier est vide.</p>');
            }
            updateTotalLength();
        };
        //Item checkbox click
        plugin.itemAction = function() {
            if ($(this).prop("checked")) {
                plugin.addToCart($(this));
            } else {
                plugin.removeFromCart($(this));
            }
            plugin.lsSet();
            updateCartButton();
            updateItemsInfos();
            updateTotalLength();
        };
        //Item Image click
        plugin.itemPreview = function() {
            //Update modal content
            //console.log('Go Update Modal!');
            var $item = $(this).closest('.lb-js-item');

            $modalPreview.find('.lp-item-title').text($(this).find('.lb-select-list-title').text());
            $modalPreview.find('.lp-item-desc').text($(this).find('.lb-select-list-legend').text());
            $modalPreview.find('.lp-item-copy').text($(this).find('.lb-select-list-copyright').text());
            $modalPreview.find('.lp-item-size').text($(this).find('.lb-select-list-infos').text());
            if ($item.find('.lb-js-item-checkbox').is(":checked")) {
                $modalPreview.find('.lp-js-item-btn-add').hide();
                $modalPreview.find('.lp-js-item-btn-remove').show();
            } else {
                $modalPreview.find('.lp-js-item-btn-add').show();
                $modalPreview.find('.lp-js-item-btn-remove').hide();
            }

            $modalPreview.find('.lp-item-img').prop('src', $item.data("itemPreview"));
            $modalPreview.find('.lp-item-img').prop('alt', $item.data("itemName"));
            //binding
            $modalPreview.find('.lp-js-item-btn').off('click').on('click', function(e) {
                e.preventDefault();
                $item.find('.lb-js-item-checkbox').trigger('click');
                if ($item.find('.lb-js-item-checkbox').is(":checked")) {
                    $modalPreview.find('.lp-js-item-btn-add').hide();
                    $modalPreview.find('.lp-js-item-btn-remove').show();
                } else {
                    $modalPreview.find('.lp-js-item-btn-add').show();
                    $modalPreview.find('.lp-js-item-btn-remove').hide();
                }
            });
        // resize Img after loading it
            $modalPreview.find('.lp-item-img').hide();
            $modalPreview.find('.lp-item-img').load( plugin.resizeImgAction);
            $modalPreview.find('.lp-item-img').fadeIn('50');
        };
        // reset Cart
        plugin.resetCartAction = function(e) {
            e.preventDefault();
            cart = {
                'folders': {},
                'items': {}
            };
            plugin.lsSet();
            plugin.regenModalAction();
            updateCartButton();
            updateItemsInfos();
            updateFoldersInfos();
            updateTotalLength();
        };

        plugin.deleteFromCartAction = function(e) {
            e.preventDefault();
            plugin.removeFromCart($(this));
            plugin.lsSet();
            plugin.regenModalAction();
            updateCartButton();
            updateItemsInfos();
            updateFoldersInfos();
            updateTotalLength();
        };

        // SubAction
        // Add item to selection
        plugin.addToCart = function($elem) {
            var itemData = $elem.closest('.lb-js-item').data();
            cart.items[itemData.itemId] = itemData;
            if (cart.folders[itemData.itemFolderId] === undefined) {
                cart.folders[itemData.itemFolderId] = {};
            }
            cart.folders[itemData.itemFolderId][itemData.itemId] = itemData;
        };
        // Remove from selection
        plugin.removeFromCart = function($elem) {
            if ($elem.hasClass('lb-js-modal-btn-drop-item')) {
                var itemData = cart.items[$elem.data('itemId')];
            } else {
                var itemData = $elem.closest('.lb-js-item').data();
            }
            delete cart.items[itemData.itemId];
            delete cart.folders[itemData.itemFolderId][itemData.itemId];
        };

        plugin.prepareCartForTemplate = function() {
            var cft = []; //Cart For Template
            // Loop for get clean JSON for templating
            Object.keys(cart.folders).forEach(function(folderKey) {
                var tempItemsArray = [];
                var folderName = '';
                Object.keys(cart.folders[folderKey]).forEach(function(itemKey) {
                    tempItemsArray.push(cart.folders[folderKey][itemKey]);
                    folderName = cart.folders[folderKey][itemKey]['itemFolderName'];
                });
                var tmp = '{ "folderId":"' + folderKey + '","folderName":"' + folderName + '", "items":' + JSON.stringify(tempItemsArray) + ' }';

                cft.push(JSON.parse(tmp));
            });


            return JSON.parse('{"folders":' + JSON.stringify(cft) + '}');
        };

        plugin.resizeImgAction = function(e) {
            var $img = $modalPreview.find('.lp-item-img'),
                $modal = $modalPreview,
                modalHeight = $modal.height() - parseInt($img.css('marginTop')),
                modalWidth = $modal.width(),
                imgHeight = $img[0].naturalHeight,
                imgWidth = $img[0].naturalWidth,
                imgMaxHeight = modalHeight;


            //  console.log('imgMaxHeight : ' + imgMaxHeight);
            //  console.log('imgHeight : ' + imgHeight);
            //  console.log('imgWidth : ' + imgWidth);
            //  console.log('modalWidth : ' + modalWidth);
            //  console.log('modalHeight : ' + modalHeight);

             var newHeight = 0,
                 newWitdh = 0,
                 ratio = 1;

             if (imgMaxHeight < imgHeight) {
                 newHeight = imgMaxHeight;
                 ratio = imgMaxHeight / imgHeight;
                 newWidth = imgWidth * ratio;
                 // Adjust for width too large
                 if (newWidth > modalWidth) {
                     newHeight = (modalWidth / newWidth) * newHeight;
                     newWidth = modalWidth;
                 }

             } else if (imgWidth >= modalWidth) {
                 newHeight = (modalWidth / imgWidth) * imgHeight;
                 newWidth = modalWidth;
                 // Adjust for width too large
                 if (newHeight > imgMaxHeight) {
                     newWidth = (imgMaxHeight / imgHeight) * newWidth;
                     newHeightWidth = modalHeight;
                 }
             } else {
                 newWidth = imgWidth;
                 newHeight = imgHeight;
             }

            // if( imgHeight/imgWidth !== newHeight/newWidth){
            //     console.log( 'Ratio Error');
            // }

            // console.log('h/w/ ratio :'+ imgHeight + '/' + imgWidth + '  '+imgHeight/imgWidth +'| new h/w / ratio:' + newHeight +  '/' + newWidth +' /' + newHeight/newWidth );


            $img.height(newHeight);
            $img.width(newWidth);
            $img.margin = 'auto';

        };

        plugin.init();
    };
    $.fn.cxpLibrary = function(options) {
        return this.each(function() {
            if (undefined === $(this).data('cxpLibrary')) {
                var plugin = new $.cxpLibrary(this, options);
                $(this).data('cxpLibrary', plugin);
            }
        });
    };
    $('.lb-js').cxpLibrary();


    //For Filter add toggle slide

    $('.lb-js-filter').toggleSlide();


})(jQuery);

/**!
 Mobile Navigation
 Sublevel touch dropdown navigation

 @contributors: Damien Senger (Alsacréations)
 @date-created: 2015-06-18
 @last-update: 2015-06-18
 */

;(function ($) {

	$.fn.toggleSlideNav = function (options) {

		var settings = $.extend({
			speed: 200
		}, options);

		return this.each(function () {
			var $_this = $(this),
				$trigger = $(this),
				$target = $('.main-navigation');

			$trigger.on('click.tsn', function () {

				if ($_this.hasClass('is-open')) {
					$target.stop().slideUp(settings.speed);
					$_this.removeClass('is-open');

				}
				else {
					$target.stop().slideDown(settings.speed);
					$_this.addClass('is-open');

				}

				return false;
			});
			$target.on('click.tsn', function (e) {
				e.stopPropagation();
			});
			$('body').on('click', function (e) {
				if ($_this.hasClass('is-open')) {
					$trigger.trigger('click.tsn');
				}
			});
		});

	};

	$('.sb-menu-trigger').toggleSlideNav();

})(jQuery);

/**!
	Mobile Navigation
	Basic dropdown menu navigation

	@contributors: Geoffrey Crofte, Rodolphe Rimelé (Alsacréations)
	@date-created: 2015-04-01
	@last-update: 2015-05-28
 */

;
(function($) {

    var $menuline = $('.mn-menu-line'),
        $menu = $('.mn-menu'),
        $submenus = $menu.find('.mn-item-has-megamenu, .mn-item-has-submenu'),
        speed = 175,
        menuInitPos = $menuline.offset(),
        scrolltimer;

    // actions on mouse interactions
    $submenus.on('click.megamenu', function(e) {
        var $parentmenu = $(this).parent().closest('.mn-item-has-submenu');
        $submenus.not($parentmenu).not($(this)).removeClass('is-open');
        $(this).toggleClass('is-open');
        var $el = $(this).find('> .mn-sub-menu-mega, > .mn-sub-menu').stop();
        if ($(this).hasClass('is-open')) {
            $el.fadeIn(speed);
        } else {
            $el.fadeOut(speed);
        }
        e.stopPropagation();
    });

    // accessibility (keyboard tab nav)
    $submenus.find('> .mn-link').on('focus', function() {
        $(this).closest('.mn-menu-item').trigger('mouseenter');
    });
    $submenus.find('a:last').on('blur', function() {
        $(this).closest('.mn-item-lvl-1').trigger('mouseleave');
    });

    // sticky things on scroll banner and sf-ttt to the top
    var $banner = $('.site-banner'),
        bannerInitPos = $banner.offset(),
        $btnTTT = $('.sf-ttt');

    $('.sf-ttt').on('click', function(){
        $("html, body").animate({
            scrollTop: 0
        }, 600);
    });
    window.addEventListener('scroll', function() {
        clearTimeout(scrolltimer);
        scrolltimer = setTimeout(function() {
            if ($(window).height() > $(window).width() || ($(window).height() > $(window).width() && $(window).height() > 400)) {
                if (bannerInitPos !== undefined && $(window).scrollTop() >= bannerInitPos.top) {
                    $banner.addClass('is-stuck');
                } else {
                    $banner.removeClass('is-stuck');
                }
            }
            if ($(window).scrollTop() >= ($(window).height() / 3)) {
                $btnTTT.addClass('is-stuck');
            } else {
                $btnTTT.removeClass('is-stuck');
            }
        }, 15);
    }, true);
    $(window).on('resize.sticky', function(){
        if( $(window).height() < 400){
            $btnTTT.addClass('is-stuck');
            $banner.removeClass('is-stuck');
        }
    });
})(jQuery);

/**!
	Module table split
	Split the column in other table

	@contributors: Guillaume Focheux (Alsacréations)
	@date-created: 2015-07-01
	@last-update: 2015-07-01
 */

;(function($) {
    /*
    *   extractAllColumns
    *   @param table element in jQuery object
    */
    function extractAllColumns( $table ){
        var nbColumn = $table.find('th').length;
        var arrayColumn = [];
        $table.find('th').each( function(){
            // Add th in the array
            arrayColumn[$(this).index()] = [$(this).html()];
        });

        for (var i = 0; i < nbColumn + 1; i++) {
            $table.find("tr td:nth-child("+i+")")
            .each( function(j){
                // Add td in the array
                arrayColumn[$(this).index()][parseInt(j+1)]= $(this).html();
            });
        }
        return arrayColumn;
    }

    function makeNewTable( tableArray , $table){

        var doc = document;
        var arrayTableHtml = [];
        $.each( tableArray, function(a){
            var arrayTmp = this;
            var thead = doc.createElement("thead");
            var tbody = doc.createElement("tbody");
            for (i = 0; i < arrayTmp.length ; i++) {
                var tr = doc.createElement("tr");
                if( i > 0){
                    var td = doc.createElement("td");
                    td.innerHTML = this[i];
                    tr.appendChild(td);
                    tbody.appendChild(tr);
                } else {
                    var th = doc.createElement("th");
                    th.innerHTML = this[i];
                    tr.appendChild(th);
                    thead.appendChild(tr);
                }
            }
            var tableTmp = doc.createElement("table");
            tableTmp.appendChild(thead);
            tableTmp.appendChild(tbody);
            arrayTableHtml[a]= tableTmp;

        });
        arrayTableHtml.reverse();
        $.each( arrayTableHtml , function(){
            $(this).insertAfter($table);
        });
    }

    //Table Selector for container provide by wysiwyg
    $('.article-content table').each(function(){
        var tableArray = extractAllColumns( $(this) );
        makeNewTable(tableArray, $(this));
        $(this).hide();
    });
})(jQuery);

/*!
 jQuery modal/lightbox plugin
 @name modal.js
 @author Alsacreations (@alsacreations)
 @version 1.0
 @date 27/05/2015
 @category jQuery Plugin
 @copyright (c) 2015 Alsacréations
 @license Licensed under the MIT (http://www.opensource.org/licenses/mit-license.php) license.
 */

(function($) {

    "use strict";
    var cxpModal, defaultOptions, modalBind;

    modalBind = function(fn, me) {
        return function() {
            return fn.apply(me, arguments);
        };
    };

    // Plugin default options
    defaultOptions = {
        // jQuery formatted selector to search for focusable items
        focusableElementsString: "a[href], area[href], input:not([disabled]), select:not([disabled]), textarea:not([disabled]), button:not([disabled]), iframe, targetect, embed, *[tabindex], *[contenteditable]",
        // store the item that has focus before opening the modal window
        focusedElementBeforeModal: undefined,
        resizeDelay: 50
    };

    cxpModal = (function(options) {

        // Constructor
        function cxpModal(handler, options) {

            // plugin variables
            this.handler = handler;
            this.modaltarget = false;
            this.resizeTimer = null;

            // Extend default options
            $.extend(true, this, defaultOptions, options);

            // Bind methods.
            this.update = modalBind(this.update, this);
            this.onResize = modalBind(this.onResize, this);
            this.init = modalBind(this.init, this);
            this.clear = modalBind(this.clear, this);

        }

        // Method for updating the plugins options
        cxpModal.prototype.update = function(options) {
            $.extend(true, this, options);
        };

        // Init
        cxpModal.prototype.init = function() {

            // Closure
            var self = this;

            // Events...
            $('body').on('click.cxpModal', this.handler.selector, function(e) {
                // Update modal target related to the handler (link)
                self.modaltarget = $($(this).data('modaltarget'));
                // Call to show the modal
                self.showModal();
                if (e !== undefined) {
                    e.preventDefault();
                }
            });

        };

        // Close method
        cxpModal.prototype.closeModal = function() {

            // Hide & mark the modal window as hidden
            this.modaltarget.hide().attr('aria-hidden', 'true');

            // Destroy all overlay
            $('.overlay').remove();

            // START custom selectors
            // mark the main page as visible
            $('body, .footer').attr('aria-hidden', 'false');
            // END custom

            // set focus back to element that had it before the modal was opened
            if (this.focusedElementBeforeModal !== undefined && this.focusedElementBeforeModal.length > 0) {
                this.focusedElementBeforeModal.focus();
            }

            // Destroy key events
            $('body').off('keydown.cxpmodal');

        };

        // Resize method
        cxpModal.prototype.onResize = function() {
            // Closure
            var self = this;
            var $target = this.modaltarget;

            // modal reduce if window width or height too little

            var windowSize = {
                "w": window.innerWidth - 50,
                "h": window.innerHeight - 50,
            };
            // console.clear();
            // console.log("windows = " + windowSize.h + "/" + windowSize.w);
            // console.log("modals = " + $target.height() + '/' + $target.width());

            var modalSize = $target.data('MaxSize'),
                modalHeight = modalSize.h,
                modalWidth = modalSize.w,
                newWidth = modalWidth,
                newHeight = modalHeight,
                ratio = 1;


            if (windowSize.h < modalHeight) {
                newHeight = windowSize.h;
                ratio = windowSize.h / modalHeight;
                newWidth = modalWidth * ratio;

                // Adjust for width too large
                if (newWidth > windowSize.w) {
                    newHeight = (windowSize.w / newWidth) * newHeight;
                    newWidth = windowSize.w;
                }

            } else if (modalWidth > windowSize.w) {
                newHeight = (windowSize.w / modalWidth) * modalHeight;
                newWidth = windowSize.w;
                // Adjust for width too large
                if (newHeight > windowSize.h) {
                    newWidth = (windowSize.h / newHeight) * newWidth;
                    newHeightWidth = windowSize.h;
                }
            }

            $target.height(newHeight);
            $target.width(newWidth);

            // modal center
            $target.css("top", 0);
            $target.css("margin-top", function() {
                return ($(window).height() - $target.height()) / 2;
            });
            $target.css("margin-left", function() {
                return 0 - ($target.width() / 2);
            });
        };
        // Main method
        cxpModal.prototype.showModal = function() {

            // Closure
            var self = this;

            //Store the predefined Modal size
            this.modaltarget.data('MaxSize', {
                "h": this.modaltarget.height(),
                "w": this.modaltarget.width()
            });

            // resize on show
            self.onResize();

            // Show the element
            this.modaltarget.show().attr('aria-hidden', 'false');


            // Bugfix for Nexus 7 and other smartphones when scrolling in modal
            $('body').addClass('bfc');

            // Set the events
            this.modaltarget.find('.m-btn-to-close').on({
                'click': function(e) {
                    self.closeModal();
                    if (e !== undefined) {
                        e.preventDefault();
                    }
                },
                'keydown': function(e) {
                    self.trapSpaceKey($(this), e, function() {
                        self.closeModal();
                    });
                }

            });
            this.modaltarget.find('.m-trigger-close').on({
                'click': function(e) {
                    self.closeModal();
                    if (e !== undefined) {
                        e.preventDefault();
                    }
                },
                'keydown': function(e) {
                    self.trapSpaceKey($(this), e, function() {
                        self.closeModal();
                    });
                }

            });
            this.modaltarget.on('keydown', function(event) {
                self.trapTabKey($(this), event);
                self.trapEscapeKey($(this), event);
            });

            // Bonus : Keydown events for swipers !
            $('body').on('keydown.cxpmodal', function(e) { // Keyboard
                var $swiper = $('.cxp-swiper', self.modaltarget);
                if ($swiper.length > 0) {
                    if (e.keyCode == 37) {
                        $swiper.data('cxpSwiper').swipePrev();
                    } else if (e.keyCode == 39) {
                        $swiper.data('cxpSwiper').swipeNext();
                    }
                }
            });

            // save the current focus
            this.focusedElementBeforeModal = $(':focus');

            // insert an overlay to prevent clicking and make a visual change to indicate the main page is not available
            if ($('.overlay').length < 1) {
                $('body').append('<div class="overlay" tabindex="-1"></div>');
                $('.overlay').addClass('is-open');
                // A click on overlay (outside modal) closes all of the modals
                $('.overlay').fadeIn().on('click', function() {
                    $(this).removeClass('is-open');
                    $('.m-btn-to-close').trigger('click');
                });
            }

            // START custom selectors & settings

            // Mark the main page as hidden
            $('body, .footer').attr('aria-hidden', 'true');

            // Managing modal when its content is too tall to fit into viewport
            // var modalHeightModal = this.modaltarget.height();
            var modalHeightModalTitle = this.modaltarget.find('.modal-header').height();

            // Keep min-height: 528px on .modal-content or not? (0.8 = 100% - top:10% - bottom:10%)
            if (($(window).height() * 0.8) - modalHeightModalTitle < 528) {
                this.modaltarget.find('.modal-content').addClass('js-no-minheight');
            }

            // var modalHeightModalContent = this.modaltarget.find('.modal-content').height();

            // 2 type of modals are managed: with Tabs and Pane (then each Pane can have a scrollbar) or without (general case: content can have a scrollbar)
            var modalHeightModalTabs = 0;
            if (this.modaltarget.find('.tabstrip-tabs').length > 0) {
                modalHeightModalTabs = this.modaltarget.find('.tabstrip-tabs').height();
                this.modaltarget.find('.tabstrip-pane').css('top', modalHeightModalTabs + modalHeightModalTitle + 15); // @NOTE 15 is the top padding on Tabs
            }


            $(window).resize(function() {
                self.onResize();
            });

            // END custom

            // Safari and VoiceOver shim
            // if VoiceOver in Safari is used, set the initial focus to the modal window itself instead of the first keyboard focusable item.
            // This causes VoiceOver to announce the aria-labelled attributes. Otherwise, Safari and VoiceOver will not announce the labels attached to the modal window.

            // set the focus to the first keyboard focusable item
            this.modaltarget.find('*').filter(this.focusableElementsString).filter(':visible').first().focus();

        };


        cxpModal.prototype.trapSpaceKey = function(target, e, f) {
            if (e.which === 32) { // if space key pressed
                f(); // fire the user passed event
                e.preventDefault();
            }
        };

        cxpModal.prototype.trapEscapeKey = function(target, e) {
            if (e.which === 27) { // if escape pressed
                target.find('.m-btn-to-close').trigger('click');
                e.preventDefault();
            }
        };

        cxpModal.prototype.trapTabKey = function(target, e) {

            // if tab or shift-tab pressed
            if (e.which === 9) {

                // get list of focusable items
                var focusableItems = target.find('*').filter(this.focusableElementsString).filter(':visible');

                // get currently focused item
                var focusedItem = $(':focus');

                // get the number of focusable items
                var numberOfFocusableItems = focusableItems.length;

                // get the index of the currently focused item
                var focusedItemIndex = focusableItems.index(focusedItem);

                if (e.shiftKey) {
                    // back tab
                    // if focused on first item and user preses back-tab, go to the last focusable item
                    if (focusedItemIndex === 0) {
                        focusableItems.get(numberOfFocusableItems - 1).focus();
                        e.preventDefault();
                    }

                } else {
                    // forward tab
                    // if focused on the last item and user preses tab, go to the first focusable item
                    if (focusedItemIndex === (numberOfFocusableItems - 1)) {
                        focusableItems.get(0).focus();
                        e.preventDefault();
                    }
                }
            }

        };

        return cxpModal;

    })();

    $.fn.cxpModal = function(options) {

        // Create a cxpModal instance if not available
        if (!this.cxpModalInstance) {
            this.cxpModalInstance = new cxpModal(this, options || {});
        } else {
            this.cxpModalInstance.update(options || {});
        }

        // Init plugin
        this.cxpModalInstance.init();

        // Display items (if hidden) and return jQuery object to maintain chainability
        return this;

    };

})(jQuery);

// Launch
jQuery(document).ready(function($) {
    "use strict";
    $('.modalopen').cxpModal();
});

/**!
 Newsletter
 Newsletter module with AJAX post

 @contributors: Rodolphe (Alsacréations)
 @date-created: 2015-05-21
 @last-update: 2015-05-21
 */

(function($) {

   $.cxpNewsletter = function(el, options) {

      var defaults = {
         newsletterPostUrl: '' // URL to post results
      };

      var plugin = this;

      plugin.settings = {};

      var $element = $(el),
          element = el;

      // Plugin initialization
      plugin.init = function() {
         plugin.settings = $.extend({}, defaults, options);
         updateSettingsFromHTMLData();
         registerEvents();
      };

      // Reads plugin settings from HTML data-* attributes (camelCase)
      var updateSettingsFromHTMLData = function() {
         var data = $element.data();
         for(var dat in data) plugin.settings[dat] = data[dat];
      };

      // Event Handlers on HTML components inside the plugin
      var registerEvents = function() {
        $('button',$element).on('click', function(e) {
          e.preventDefault();
          plugin.postData();
        });
      };

      // Plugin post data to server with AJAX request
      plugin.postData = function() {
          var $form = $('form',$element);
          $element.addClass('is-loading');
          var formData = $form.serialize();
          $('form',$element).remove();
          $.post(plugin.settings.newsletterPostUrl, formData, function(html) {
            setTimeout(function() {
              $element.addClass('with-results').removeClass('is-loading');
              $('.nf-result',$element).html(html);
            },750);
          });
      };

      plugin.init();

   };

   $.fn.cxpNewsletter = function(options) {

       return this.each(function() {
           if (undefined === $(this).data('cxpNewsletter')) {
               var plugin = new $.cxpNewsletter(this, options);
               $(this).data('cxpNewsletter', plugin);
           }
       });

   };

   $('.cxp-newsletter').cxpNewsletter();

 })(jQuery);

/**!
	NOM DU MODULE
	Description du module

	@contributors: Geoffrey Crofte (Alsacréations), Guillaume Focheux (Alsacréations)
	@date-created: 2015-03-26
	@last-update: 2015-03-26
 */
 
;(function($) {

	// Code is jQuery

})(jQuery);
/**!
 AJAX pagination
 Links that load HTML via XHR into target element and update the links list

 @contributors: Geoffrey Crofte (Alsacréations), Guillaume Focheux (Alsacréations), Rodolphe (Alsacréations)
 @date-created: 2015-04-13
 @last-update: 2015-07-06
 */

;
(function($) {

  function pagination_change(e) {

    // Vars
    var separator = '?'; // @PROD edit to '/'
    var $this = $(this);
    var page = $this.data('page');
    if(page===undefined) return true; // Don't disturb true links (not page links)

    e.preventDefault();
    if($this.parent().hasClass('is-inactive')) {
      return false;
    }

    var $pagination_container = $this.closest('.cxp-pagination');
    var $target_container = $('[data-container-id=' + $pagination_container.data('container') + ']');
    var pagemax = $pagination_container.data('pageMax');
    var pagedisp = $this.closest('.pagination').data('pagedisp');
    if(pagedisp===undefined) pagedisp = 10;
    var pageBefore = $('.is-active a', $pagination_container).data('page'); // current
    var url = $this.data('url');
    var $link = $this;

    // Prev/next links are NOT numbers
    if (isNaN(parseInt(page))) {

      $link = $('.is-active a', $pagination_container);
      if(pagedisp<1) { // Pagination without numbers (only prev/next links)
        var currentpage = $pagination_container.data('currentpage');
        if(!currentpage) currentpage = 1;
        if(page=='next') currentpage++;
        else if(page=='prev') currentpage--;
        $pagination_container.data('currentpage',currentpage);
        page = currentpage;
      } else {
        if (page == 'next') {
          page = Math.min(pagemax, parseInt($link.data('page')) + 1);
        } else if (page == 'prev') {
          page = Math.max(1, parseInt($link.data('page')) - 1);
        }
      }

      $link = $('[data-page=' + page + ']', $pagination_container);

      // Regenerate page groups (10-20, 20-30... or less with custom pagedisp)
      if (pagedisp>0 && $link.length < 1) {
        $('li:not(.pagin-prev,.pagin-next)', $pagination_container).remove();
        var pagestart = Math.ceil(((page - 1) / 10) *10);
        var html = '';
        for (i = pagestart + 1; i <= pagestart + pagedisp; i++) {
          html += '<li class="pagin-item"><a href="' + separator + (i) + '" data-url="' + $pagination_container.data('url') + separator + (i) + '" data-page="' + (i) + '" title="page ' + (i) + '">' + (i) + '</a></li>';
        }
        // First link (page 1)
        if (pagestart !== 0) {
          i = 1;
          html = '<li class="pagin-item"><a href="' + separator + (i) + '" data-url="' + $pagination_container.data('url') + separator + (i) + '" data-page="' + (i) + '" title="page ' + (i) + '">' + (i) + '</a></li><li class="pagin-item">...</li>' + html;
        }
        // Last link (page max)
        if (pagestart + pagedisp !== pagemax) {
          i = pagemax;
          html += '<li class="pagin-item">...</li><li class="pagin-item"><a href="' + separator + (i) + '" data-url="' + $pagination_container.data('url') + separator + (i) + '" data-page="' + (i) + '" title="page ' + (i) + '">' + (i) + '</a></li>';
        }
        $('.pagin-next', $pagination_container).before(html);
        $link = $('[data-page=' + page + ']', $pagination_container);
      }
      url = $link.data('url');
      if(!url) url = $pagination_container.data('url')+separator+page; // if pagedisp==0
    }

    $('.pagin-grids-next, .pagin-next',$pagination_container).toggleClass('is-inactive',page===pagemax);
    $('.pagin-grids-prev, .pagin-prev',$pagination_container).toggleClass('is-inactive',page<=1);

    // CSS classes
    $('li', $pagination_container).removeClass('is-active');
    $link.closest('li').addClass('is-active');

    // Ajax load
    if ($target_container !== false && $target_container.length>0) {

      // HTML5 History API push
			/*
      if (history.pushState) {
        if (!$pagination_container.data('pushState')) {
          history.replaceState({
            page: pageBefore,
            container: $pagination_container.data('container')
          }, document.title, $(this).attr('href'));
        }
        history.pushState({
          page: page,
          container: $pagination_container.data('container')
        }, document.title, $(this).attr('href'));
        $pagination_container.data('pushState', true);
      }
			*/
      $target_container.load(url);
    } else {
      console.log('Target container not found for pagination');
    }
  }

  // Pagination plugin
  $.fn.cxpPagination = function() {
    $(this).each(function() {
      $(this).on('click', 'a', pagination_change);
    });
  };

  $('.cxp-pagination').cxpPagination();

	// HTML5 History API pop
	/*
  $(window).on('popstate', function(e) {
    var state = e.originalEvent.state;
		if(state !== undefined && state.page !== undefined && state.container !== undefined) {
			$('[data-container='+state.container+']').find('[data-page='+state.page+']').trigger('click');
		}
  });
	*/

})(jQuery);

/**!
 Pagination Ajax
 Module de pagination d'élément via XHR pour la récupération et affichage

 @contributors: Geoffrey Crofte (Alsacréations), Guillaume Focheux (Alsacréations)
 @date-created: 2015-04-13
 @last-update: 2015-04-13
 */

;
(function($) {
  if ($('.pagination').length > 0) {
    // template to basic gla-item elements
    var tpl_grid_list = '' +
      '<div class="gla-item"><a href="[gla-link]">' +
      '    <img class="gla-item-img" src="[gla-item-img-src]" width="[gla-item-img-w]" height="[gla-item-img-h]" alt="">' +
      '    <span class="gla-item-tag">[gla-item-tag]</span>' +
      '    <div class="gla-item-content">' +
      '	<p class="gla-item-btn"><span class="btn-primary">[btn-primary]</span></p>' +
      '	<h2 class="gla-item-title">[gla-item-title]</h2>' +
      "	<p>[gla-item-text]</p>" +
      '	<p class="gla-item-author">Publié le <time datetime="2015-02-15" class="gla-item-date" publishDate=[la-item-date-format]>[la-item-date-display]</time> par <strong>[gla-item-author]</strong></p>' +
      '    </div>' +
      '</a></div>',
      tpl_prev_a = '<a href="#" data-page="prev"><i class="icon icon-long-arrow-left" aria-hidden="true"></i> Précédent</a>',
      tpl_prev_span = '<span data-page="prev"><i class="icon icon-long-arrow-left" aria-hidden="true"></i> Précédent</span>',
      tpl_next_a = '<a href="#" data-page="next">Suivant <i class="icon icon-long-arrow-right" aria-hidden="true"></i></a>',
      tpl_next_span = '<span href="#" data-page="next">Suivant <i class="icon icon-long-arrow-right" aria-hidden="true"></i></span>';

    var dataPage = '',
      pageLoaded = new Array(); // variable to know if already loaded or not

    // function to get the json and send to the processing function for generation if necessary
    function pa_getPage(url, nbPage, $paginationElem, $pa_pageContainer) {
      var urlToLoad = url + "?nbPage=" + nbPage;
      if (($pa_pageContainer.attr('data-page-current') == 1 && nbPage == 2) || ($pa_pageContainer.attr('data-page-current') == 2 && nbPage == 1)) {
        pa_toggle_arrow('prev', $paginationElem);
      }

      if ($.inArray(urlToLoad, pageLoaded) >= 0) {
        return 2;
      }
      $.getJSON(urlToLoad, function(data) {
        pa_generatePage(data, urlToLoad, nbPage, $pa_pageContainer);
      });
      return 1;
    }

    // generate in the DOM the new page
    function pa_generatePage(data, urlToLoad, nbPage, $pa_pageContainer) {

      var classToAdd = 'pagination-grid-next';
      if (nbPage < $pa_pageContainer.attr('data-page-current')) {
        classToAdd = 'pagination-grid-prev';
      }
      if (nbPage > $pa_pageContainer.attr('data-page-current')) {
        classToAdd = 'pagination-grid-next';
      }
      // create elem to append
      var new_page = $(document.createElement('div'));
      new_page.addClass('grid-la-list ' + classToAdd).attr('data-page-number', nbPage);
      $pa_pageContainer.append(new_page);
      //generate content
      var inner = '';
      data['gla-item'].forEach(function(gla_item) {
        inner += pa_generateItem(gla_item);
      });
      new_page[0].innerHTML = inner;
      pageLoaded.push(urlToLoad);
    }
    // toggle link to span and reverse
    function pa_toggle_arrow(arrow_type, $paginationElem) {
      if (arrow_type == undefined) {
        return false;
      }
      $toToggle = $('[data-page="' + arrow_type + '"]', $paginationElem);
      if ($toToggle[0].tagName == 'SPAN') {
        $toToggle[0].outerHTML = eval('tpl_' + arrow_type + '_a');
      } else {
        $toToggle[0].outerHTML = eval('tpl_' + arrow_type + '_span');
      }


    }
    // generate item
    function pa_generateItem(item) {
      // replace the content of template
      tmp_tpl = tpl_grid_list;
      tmp_tpl = tmp_tpl.replace('[gla-link]', item['gla-link']);
      tmp_tpl = tmp_tpl.replace('[gla-item-tag]', item['gla-item-tag']);
      tmp_tpl = tmp_tpl.replace('[btn-primary]', item['gla-item-content']['btn-primary']);
      tmp_tpl = tmp_tpl.replace('[gla-item-title]', item['gla-item-content']['gla-item-title']);
      tmp_tpl = tmp_tpl.replace('[la-item-date-format]', item['gla-item-content']['la-item-date']);
      tmp_tpl = tmp_tpl.replace('[la-item-date-display]', item['gla-item-content']['la-item-date']);
      tmp_tpl = tmp_tpl.replace('[gla-item-author]', item['gla-item-content']['gla-item-author']);
      tmp_tpl = tmp_tpl.replace('[gla-item-text]', item['gla-item-content']['gla-item-text']);
      tmp_tpl = tmp_tpl.replace('[gla-item-img-src]', item['gla-item-img']['src']);
      tmp_tpl = tmp_tpl.replace('[gla-item-img-w]', item['gla-item-img']['width']);
      tmp_tpl = tmp_tpl.replace('[gla-item-img-h]', item['gla-item-img']['height']);
      return tmp_tpl;
    }

    function pa_update_number($paginationElem, nbPage) {

      // paginaction
      $('li', $paginationElem).each(function() {
        if ($(this).attr('data-page') == undefined) {
          return;
        }
        if (nbPage == $(this).attr('data-page')) {
          $(this).addClass('is-active');
        } else {
          $(this).removeClass('is-active');
        }
      });

    }

    function pa_action() {

      var $paginationElem = $(this).closest('.pagination'),
        $pa_pageContainer = $('[data-container-id="' + $paginationElem.attr('data-container') + '"]'),
        url = $paginationElem.attr('data-url'),
        nbPage = $(this).attr('data-page');
      if (nbPage === 'next') {
        nbPage = parseInt($pa_pageContainer.attr('data-page-current')) + 1;
      }
      if (nbPage === 'prev') {
        nbPage = parseInt($pa_pageContainer.attr('data-page-current')) - 1;
      }
      // Get en generate Page
      pa_getPage(url, nbPage, $paginationElem, $pa_pageContainer);

      $pa_pageContainer.attr('data-page-current', nbPage);
      var interTmp = setInterval(function() {
        // effect CSS
        $('.grid-la-list', $pa_pageContainer).each(function() {
          // class switcher for effect CSS
          if ($(this).attr('data-page-number') != $pa_pageContainer.attr('data-page-current') && $(this).attr('data-page-number') != nbPage) {
            $(this).addClass('pagination-grid-move');
          }
          if ($(this).attr('data-page-number') == $pa_pageContainer.attr('data-page-current') || $(this).attr('data-page-number') == nbPage) {
            $(this).removeClass('pagination-grid-move');
          }
          if ($(this).attr('data-page-number') > nbPage) {
            $(this).removeClass('pagination-grid-prev');
            $(this).addClass('pagination-grid-next');
          }
          if ($(this).attr('data-page-number') < nbPage) {
            $(this).removeClass('pagination-grid-next');
            $(this).addClass('pagination-grid-prev');
          }
        }).delay(500);

        $("[data-page-number=" + nbPage + "]", $pa_pageContainer).removeClass('pagination-grid-next').removeClass('pagination-grid-prev');
        clearInterval(interTmp);
      }, 500);

      pa_update_number($paginationElem, nbPage);
    }

    $.fn.pagination = function() {
      $(this).each(function() {
        // addcurrent page
        pageLoaded.push($(this).data('url') + "?nbPage=" + $('.pagination-grid[data-container-id="' + $(this).attr('data-container') + '"]').attr('data-page-current'));
        $(this).on('click', 'a', pa_action);
      });
    };

    $('.pagination').pagination();
  }
})(jQuery);

/**!
 partner_load

 	Little plugin for get in AJAX partner list and add it in the view
	We can show or hide the new ellements

 @contributors: Guillaume Focheux (Alsacréations)
 @date-created: 2015-04-24
 @last-update: 2015-04-24
 */

;
(function ($) {

	function partner_load(e) {

		// Vars
		var $this = $(this);// trigger button
		var $partner_container = $(this).closest('.js-partner-ajax-load');
		var $receiver_container = $partner_container.find('.js-pal');
		var url = $partner_container.data('url');

		if (!$(this).hasClass('js-already-load')) {
			// Ajax load
			if ($receiver_container !== false) {
				$receiver_container.load(url);
				$(this).addClass('js-already-load');
			}
		}
		// CSS classes
		$receiver_container.toggleClass('is-visible');

		$textNotHide = $(this).find('span').not('.js-hidden');
		$textHide = $(this).find('span.js-hidden');
		$textNotHide.addClass('js-hidden');
		$textHide.removeClass('js-hidden');
		e.preventDefault();
	}

	// Pagination plugin
	$.fn.partnerLoad = function () {
		$(this).each(function () {
			$(this).on('click', '.js-pal-trigger', partner_load);
		});
	};

	$('.js-partner-ajax-load').partnerLoad();

})(jQuery);

/**!
 Search Form
 Search form

 @contributors: Geoffrey Crofte (Alsacréations), Rodolphe (Alsacréations)
 @date-created: 2015-04-01
 @last-update: 2015-05-22
 */

;

(function($) {

  $.cxpSearchform = function(el, options) {

    var defaults = {};

    var plugin = this;

    plugin.settings = {};

    var $element = $(el),
      element = el;

    // Plugin initialization
    plugin.init = function() {
      plugin.settings = $.extend({}, defaults, options);
      updateSettingsFromHTMLData();
      registerEvents();
    };

    // Reads plugin settings from HTML data-* attributes (camelCase)
    var updateSettingsFromHTMLData = function() {
      var data = $element.data();
      for (var dat in data)
        plugin.settings[dat] = data[dat];
    };

    // Event Handlers on HTML components inside the plugin
    var registerEvents = function() {

      $element.each(function() {

        var $_this = $(this),
          $target = $_this.find('.js-toggle-target');

        // Button to display search, only on pages with .site-banner
        if ($_this.closest('.site-banner').length > 0) {

          // Button creation
          $target.before('<button class="gsf-trigger js-toggle-trigger unstyled" type="button" title="' + $target.data('title') + '"><i class="icon icon-search" aria-hidden="true"></i><span class="gsf-trigger-text visually-hidden">' + $target.data('trigger-text') + '</span></button>');

          $_this.find('.js-toggle-trigger').on('click', function(e) {
            var $target = $(this).closest('.js-gsf');
            $target.toggleClass('is-visible');
            if ($target.hasClass('is-visible')) {
              $target.find('input#search').focus();
            }
            return false;

          });
          $target.find('input#search').on('click', function() {
            return false;
          });
          $target.find('input#search').on('focus', function() {
            $(this).closest('.gsf-input-line').addClass('is-focused');
            return false;
          });
          $target.find('input#search').on('blur', function() {
            $(this).closest('.gsf-input-line').removeClass('is-focused');
            return false;
          });
          // disappear when click out
          $('body').on('click', function() {
            if ($_this.find('.js-toggle-trigger').closest('.js-gsf').hasClass('is-visible')) {
              $_this.find('.js-toggle-trigger').closest('.js-gsf').toggleClass('is-visible');
              if ($_this.find('.js-toggle-trigger').hasClass('text-only')) {
                $_this.find('.js-toggle-trigger').toggleClass('text-only');
                $_this.find('.js-toggle-trigger').closest('.js-gsf').find('input#search').val('');
                $_this.find('.js-toggle-trigger').attr('title', 'Déplier la recherche');
              }
            }
          });

        }

        // Typeahead config
        var lastArticles = new Bloodhound({
            datumTokenizer: Bloodhound.tokenizers.obj.whitespace("title"),
            queryTokenizer: Bloodhound.tokenizers.whitespace,
            prefetch: 'inc/json/search-results-sample.json',
            //remote: 'inc/queries/%QUERY.json'
          }),
          lastExhibitors = new Bloodhound({
            datumTokenizer: Bloodhound.tokenizers.obj.whitespace("title"),
            queryTokenizer: Bloodhound.tokenizers.whitespace,
            prefetch: 'inc/json/search-results-sample.json',
            //remote: 'inc/queries/%QUERY.json'
          }),
          lastProducts = new Bloodhound({
            datumTokenizer: Bloodhound.tokenizers.obj.whitespace("title"),
            queryTokenizer: Bloodhound.tokenizers.whitespace,
            prefetch: 'inc/json/search-results-sample.json',
            //remote: 'inc/queries/%QUERY.json'
          }),
          lastEvents = new Bloodhound({
            datumTokenizer: Bloodhound.tokenizers.obj.whitespace("title"),
            queryTokenizer: Bloodhound.tokenizers.whitespace,
            prefetch: 'inc/json/search-results-sample.json',
            //remote: 'inc/queries/%QUERY.json'
          }),
          suggestTemplate = '<p><span class="tt-suggest-img"><img src="{{image}}" alt="" width="31" height="31"></span><span class="tt-suggest-text">{{title}}</span></p>',
          $_the_input = $_this.find('.gsf-input'),
          langSuggestionText = $_the_input.data('suggestion-text');

        lastArticles.initialize();
        lastExhibitors.initialize();
        lastProducts.initialize();
        lastEvents.initialize();

        $_the_input.typeahead({
          hint: true,
          highlight: true,
          minLength: 3
        }, {
          name: 'articles',
          displayKey: 'title',
          source: lastArticles.ttAdapter(),
          templates: {
            header: '<span class="typeahead-section-name">Articles</span>',
            suggestion: Handlebars.compile(suggestTemplate)
          }
        }, {
          name: 'exposants',
          displayKey: 'title',
          source: lastExhibitors.ttAdapter(),
          templates: {
            header: '<span class="typeahead-section-name">Exposants</span>',
            suggestion: Handlebars.compile(suggestTemplate)
          }
        }, {
          name: 'produits',
          displayKey: 'title',
          source: lastProducts.ttAdapter(),
          templates: {
            header: '<span class="typeahead-section-name">Produits</span>',
            suggestion: Handlebars.compile(suggestTemplate)
          }
        }, {
          name: 'evenements',
          displayKey: 'title',
          source: lastEvents.ttAdapter(),
          templates: {
            header: '<span class="typeahead-section-name">Évènements</span>',
            suggestion: Handlebars.compile(suggestTemplate)
          }
        });

        $_the_input.on('typeahead:opened', function() {
          if ($(this).nextAll('.tt-dropdown-menu').find('.tt-text-intro').length === 0) {
            $(this).nextAll('.tt-dropdown-menu').prepend('<span class="tt-text-intro">' + langSuggestionText + '</span>');
          }
        });

      });

      // Sticky things on scroll (gc)
      var gsf_scrolltimer,
        gsf_menuInitPos = $('.site-banner').outerHeight(), //gc
        $headerSearch = $('.body-visual .site-banner .js-gsf'); // gc

      if ($headerSearch.length > 0) {

        var $trigger = $('.js-toggle-trigger', $element);

        var $searchfield = $('[name=search]', $headerSearch);
        $searchfield.on('keyup', function() {
          $trigger.toggleClass('text-only', $(this).val().length > 0);
        });

        window.addEventListener('scroll', function() {

          clearTimeout(gsf_scrolltimer);
          gsf_scrolltimer = setTimeout(function() {

            if ($(window).scrollTop() >= gsf_menuInitPos) {

              $trigger.attr('title', 'Déplier la recherche');
              $trigger.on('click.cxpnosearch', function(e) {
                var $searchfield = $('[name=search]', $element);
                var searchvalue = $searchfield.val();
                if (searchvalue.length > 0) {
                  $(this).closest('form').trigger('submit');
                }
                e.preventDefault();
              });

            } else {

              $trigger.off('click.cxpnosearch').attr('title', 'Lancer la recherche');

            }

          }, 30);
        }, true);
      }
    };

    plugin.init();

  };

  $.fn.cxpSearchform = function(options) {

    return this.each(function() {
      if (undefined === $(this).data('cxpSearchform')) {
        var plugin = new $.cxpSearchform(this, options);
        $(this).data('cxpSearchform', plugin);
      }
    });

  };

  $('.cxp-searchform').cxpSearchform();

})(jQuery);

/**!
 Selection
 Add to selection module

 @contributors: Rodolphe (Alsacréations)
 @date-created: 2015-05-13
 @last-update: 2015-05-13
 */

(function($) {

  $.cxpAddToSelection = function(el, options) {

    var defaults = {
      action: '', // action of the button/link, "add" or "remove"
      modaltarget: false // modal element to display messages
    };

    var plugin = this;

    plugin.settings = {};

    var $element = $(el),
      element = el;

    // Plugin initialization
    plugin.init = function() {
      plugin.settings = $.extend({}, defaults, options);
      updateSettingsFromHTMLData();
      registerEvents();
    };

    // Reads plugin settings from HTML data-* attributes (camelCase)
    var updateSettingsFromHTMLData = function() {
      // Quick add for modal confirm
      $element.data('modaltarget', '#addtoselection-modal');
      var data = $element.data();
      for (var dat in data)
        plugin.settings[dat] = data[dat];
    };

    // Event Handlers on HTML components inside the plugin
    var registerEvents = function() {
      $element.addClass('modalopen');
      $element.on('click', function(e) {
        e.preventDefault();
        if (plugin.settings.action == 'add')
          plugin.addToSelection();
        else if (plugin.settings.action == 'remove')
          plugin.removeFromSelection();
      });
    };

    // Add item to selection
    plugin.addToSelection = function() {
      // @PROD : add here code to add item to selection (for ex : AJAX request)
      // @PROD : item ID is stored in plugin.settings.itemid

      // Display confirmation message
      $('.modal-text', $(plugin.settings.modaltarget)).text(plugin.settings.addmodaltxt);

      // Switch to remove button
      $element.data('action', 'remove');
      plugin.settings.action = 'remove';
      $('.icon', $element).removeClass('icon-plusdisk').addClass('icon-minus');
      $('span', $element).text(plugin.settings.removetxt);
    };

    // Remove from selection
    plugin.removeFromSelection = function() {
      // @PROD : add here code to remove item from selection (for ex : AJAX request)
      // @PROD : item ID is stored in plugin.settings.itemid

      // Display confirmation message
      $('.modal-text', $(plugin.settings.modaltarget)).text(plugin.settings.removemodaltxt);

      // Switch to add button
      $element.data('action', 'add');
      $('.icon', $element).removeClass('icon-minus').addClass('icon-plusdisk');
      plugin.settings.action = 'add';
      $('span', $element).text(plugin.settings.addtxt);
    };

    plugin.init();

  };

  $.fn.cxpAddToSelection = function(options) {

    return this.each(function() {
      if (undefined === $(this).data('cxpAddToSelection')) {
        var plugin = new $.cxpAddToSelection(this, options);
        $(this).data('cxpAddToSelection', plugin);
      }
    });

  };

  $('.cxp-addtoselection').cxpAddToSelection();

})(jQuery);

/**!
 Slider
 Description du module

 @contributors: Guillaume Focheux (Alsacréations)
 @date-created: 2015-04-09
 @last-update: 2015-04-24
 */

;
(function ($, window, document, undefined) {

	// Create the defaults once
	var pluginName = 'cxpSlider',
		defaults = {
			//Options Plugin Here
		},
		defaultsSwiper = {
			// Optional parameters
			direction: 'horizontal',
			loop: true,
			slidesPerView: 1,
			slidesPerGroup: 1,
			slideClass: "slider-item",
			speed: 700,
			autoplay: 0,
			simulateTouch: false,
			// If we need pagination
			pagination: '.slider-pagin-nb',
			paginationClickable: true,
			a11y: true,
			bulletClass: "slider-pagin-item",
			bulletActiveClass: "is-active",
			paginationHiddenClass: "",
			// Navigation arrows
			nextButton: '.slider-btn-next',
			prevButton: '.slider-btn-prev',
			buttonDisabledClass: 'slider-btn-disabled',
			// observer
			observer: true,
			observeParents: true,
			//Unused by SwiperJS but use for Change pagin
			alsaCustomPagin: 0
		};

	// The actual plugin constructor
	function cxpSlider(_caller, selector, options) {
		this._caller = _caller;
		this.selector = selector;
		this.sliders = {};
		//options override
		this.options = $.extend({}, defaults, options);
		this._defaults = defaults;
		//options for the plugin (can be override by the attr/data data-slider-param on container
		this._defaultsSwiper = defaultsSwiper;
		this._name = 'cxpSlider';
		this.init();
	}

	//Prototype of the object
	cxpSlider.prototype = {
		init: function () {
			var instance = this;
			var arraySlider = {};
			var sliderDefaultOpt = this._defaultsSwiper;

			$(this.selector).each(function (index) {
				var newClass = 'slider-instance-' + index;
				var sliderOptions = $.extend({}, sliderDefaultOpt, $(this).data('sliderParam'));
				//change option with more precise selector for multiple slider
				sliderOptions.nextButton = '.' + newClass + ' ' + sliderOptions.nextButton;
				sliderOptions.prevButton = '.' + newClass + ' ' + sliderOptions.prevButton;
				sliderOptions.pagination = '.' + newClass + ' ' + sliderOptions.pagination;
				//Pagination with n/N
				if (sliderOptions.alsaCustomPagin === 1) {
					sliderOptions.paginationClickable = false;
					sliderOptions.paginationHide = true;

					//console.log($(this).find('.slider-item').length);
					$(this).find('.slider-nb-total').text($(this).find('.slider-item').length);
					if (sliderOptions.slidesPerView > 1) {
						$(this).find('.slider-nb-end').text('-' + sliderOptions.slidesPerView).attr('data-nbto', sliderOptions.slidesPerView);
					} else {
						$(this).find('.slider-nb-end').text('').attr('data-nbto', sliderOptions.slidesPerView);
					}
					$(this).find('.slider-nb-start').text(1).attr('data-nbfrom', 0);


					sliderOptions.onSlideChangeEnd = function (swiper) {

						var $this_swiper = $(swiper.container),
							$from = $this_swiper.find('.slider-nb-start'),
							$from_data = $this_swiper.find('.slider-nb-start').data('nbfrom'),
							$to = $this_swiper.find('.slider-nb-end'),
							$to_data = $this_swiper.find('.slider-nb-end').data('nbto');
						//Debug DATA
//						console.log(newClass);
//						console.log('$from_data = ' + parseInt($from_data));
//						console.log('$to_data = ' + parseInt($to_data));
//						console.log('swiper.activeIndex = ' + swiper.activeIndex);
//						console.log('result = ' + (parseInt($to_data) + swiper.activeIndex + 1));


						if (swiper.activeIndex !== 0) {
							if (swiper.params.slidesPerView > 1) {
								$from.text(swiper.activeIndex + 1);
							} else {
								$from.text(swiper.activeIndex + 1);
							}
						} else {
							$from.text(swiper.activeIndex + 1);
						}
						if (swiper.params.slidesPerView > 1) {

							if (swiper.activeIndex !== 0) {
								$to.text('-' + (parseInt($to_data) + swiper.activeIndex));
							} else {
								$to.text('-' + $to_data);
							}
						}
					};
				}

				$(this).addClass(newClass);
				var tmpSlider = $(this).swiper(sliderOptions);

				// default set play/pause button for autoplay
				if (tmpSlider.params.autoplay > 0) {
					tmpSlider.container.addClass('js-autoplay-active');
					$('.slider-play-btn', tmpSlider.container).find('.icon-play').removeClass('icon-play').addClass('icon-pause');
				} else {
					$('.slider-play-btn', tmpSlider.container).find('.icon-pause').removeClass('icon-pause').addClass('icon-play');
				}
				//Bind the button play/pause
				$('.' + newClass + ' ' + '.slider-play-btn').on('click', function (e) {
					e.preventDefault();
					instance.playToggle(instance.sliders[newClass]);
				});

				tmpSlider.container.data('swiper', tmpSlider);
				arraySlider[newClass] = tmpSlider;
				//console.log(tmpSlider.container.data('swiper'));
			});
			this.sliders = arraySlider;
			return instance;
		},
		playToggle: function (slider) {
			//toggle button PLay/Pause autoplay
			if (slider.container.hasClass('js-autoplay-active')) {
				slider.stopAutoplay();
				slider.params.autoplay = 0;
				slider.container.removeClass('js-autoplay-active');
				$('.slider-play-btn', slider.container).find('.icon-pause').removeClass('icon-pause').addClass('icon-play');
			} else {
				slider.stopAutoplay();
				slider.params.autoplay = 1000;
				slider.startAutoplay();
				slider.container.addClass('js-autoplay-active');
				$('.slider-play-btn', slider.container).find('.icon-play').removeClass('icon-play').addClass('icon-pause');
			}
		},
		bindUpdateCustomPagin: function (slider) {

		},
		getSlider: function (classSlider) {
			// in case get an specifique Slider with slider-instance-N N is an integer
			return this.sliders[classSlider];
		}
	};

	// Instanciate the plugin AlsaSlider and put it in a variable
	$.fn['cxpSlider'] = function (options) {
		return this.each(function () {
			if (!$.data(this, "cxpSlider")) {
				$.data(this, "cxpSlider",
					this.cxpSlider = new cxpSlider(this, options));
			}
		});
	};

	if ($('.cxp-slider').length > 0) {
		$('body').cxpSlider('.cxp-slider');
	}

})(jQuery, window, document);

/*
 Summary Not Accordeon
 Permet de mettre en place un menu qui scroll à l'élement et ouvre le premier item,
 Permet aussi de gérer les dépliages/repliages

 classes utilisée:
 .js-sna-menu
 .js-sna-item-container
 .js-sna-item-dist-container
 .js-sna-item-dist-link when link and content aren't
 .js-sna-item
 .js-sna-item-link
 .js-sna-item-link-list

 .js-sna-item-content


 @contributors:  Guillaume Focheux (Alsacréations)
 @date-created: 2015-04-21
 @last-update: 2015-06-01
 */
;
(function ($) {

//ScrollTo

// Bind click handler to menu items
	// so we can get a fancy scroll animation
	$('.js-sna-menu a').on('click', function (e) {
		e.preventDefault();
		var href = $(this).attr("href"),
			offsetTop = href === "#" ? 0 : $(href).offset().top - 20;
		$('html, body').stop().animate({
			scrollTop: offsetTop
		}, 300);

		if ($(href).hasClass('js-sna-item-container')) {
			if ($(href).find('.js-sna-item-link').length > 0) {
				$(href).find('.js-sna-item-link').first().not('.is-active').trigger('click');
			}
		} else if ($(href).find('.js-sna-item-dist-container').length > 0) {

			$(href).find('.js-sna-item-dist-link').first().trigger('click');
		}
	});

//Click


	$('.js-sna-item-link').on('click', function (e) {
		e.preventDefault();
		$(this).toggleClass('is-active');
		if ($('.icon-plus', this).length > 0) {
			$('.icon-plus', this).addClass('icon-minus').removeClass('icon-plus');
			$(this).closest('.js-sna-item').children('.js-sna-item-content').addClass('is-open');
		} else if ($('.icon-minus', this).length > 0) {
			$('.icon-minus', this).removeClass('icon-minus').addClass('icon-plus');
			$(this).closest('.js-sna-item').children('.js-sna-item-content').removeClass('is-open');
		}
	});


	if ($('.js-sna-item-dist-link').length > 0) {
		//reset container
		function resetContainer($container) {
			$container.removeClass('item-is-open');
			$container.find('.js-sna-item-content').removeClass('is-open');
			$('.is-active', $container).removeClass('is-active');

		}
		$('.js-sna-item-content-btn').on('click', function () {
			$container = $(this).closest('.js-sna-item-dist-container');
			resetContainer($container);
		});


		$('.js-sna-item-dist-link').on('click', function (e) {
			e.preventDefault(); //stop ebulition and the default action
			// get the container
			var $container = $(this).closest('.js-sna-item-dist-container');
			// define as open the container for CSS
			if (!$container.hasClass('item-is-open')) {
				$container.addClass('item-is-open');
			}

			// reset all active links in the container and active the current
			$('.is-active', $container).removeClass('is-active');
			$(this).addClass('is-active');
			//get index of link for open the good .js-sna-item-content in .is-open
			var indexElem = $(this).closest('.js-sna-item').index();
			var $elems = $container.find('.js-sna-item-content');
			var $elem = $elems.eq(indexElem);
			$elems.removeClass('is-open');
			$elem.addClass('is-open');
			//bind the cross button with reset container


		});
	}




})(jQuery);
/**!
 Survey
 Survey module with AJAX post

 @contributors: Rodolphe (Alsacréations)
 @date-created: 2015-04-28
 @last-update: 2015-04-28
 */

(function($) {

  $.cxpSurvey = function(el, options) {

    var defaults = {
      surveyPostUrl: '' // URL to post results
    };

    var plugin = this;

    plugin.settings = {};

    var $element = $(el),
      element = el;

    // Plugin initialization
    plugin.init = function() {
      plugin.settings = $.extend({}, defaults, options);
      updateSettingsFromHTMLData();
      registerEvents();

      //btn-disable by default if no checked
      if ($element.find(':checked').length === 0) {
        $element.find('button').addClass('btn-disabled').attr('disabled', true);
      }
    };

    // Reads plugin settings from HTML data-* attributes (camelCase)
    var updateSettingsFromHTMLData = function() {
      var data = $element.data();
      for (var dat in data)
        plugin.settings[dat] = data[dat];
    };

    // Event Handlers on HTML components inside the plugin
    var registerEvents = function() {
      $('.btn-primary', $element).on('click', function(e) {
        e.preventDefault();
        plugin.postData();
      });
      $($element).on('click', function(e) {
        if ($element.find(':checked').length === 0) {
          $element.find('button').addClass('btn-disabled').attr('disabled', true);
        } else {
          $element.find('button').removeClass('btn-disabled').attr('disabled', false);
        }
      });
    };

    // Plugin post data to server with AJAX request
    plugin.postData = function() {
      var $form = $('form', $element);
      var formData = $form.serialize();
      $form.remove();
      $element.addClass('is-loading');
      $.post(plugin.settings.surveyPostUrl, formData, function(html) {
        setTimeout(function() {
          $element.removeClass('is-loading').addClass('with-results');
          $('.sv-results', $element).html(html);
          setTimeout(function() {
            $('.sv-results .toanimate', $element).removeClass('toanimate');
          }, 100);
        }, 750);
      });
    };

    plugin.init();

  };

  $.fn.cxpSurvey = function(options) {

    return this.each(function() {
      if (undefined === $(this).data('cxpSurvey')) {
        var plugin = new $.cxpSurvey(this, options);
        $(this).data('cxpSurvey', plugin);
      }
    });

  };

  $('.cxp-survey').cxpSurvey();

})(jQuery);

/**!
 Hammer jQuery plugin
 https://github.com/hammerjs/jquery.hammer.js/blob/master/jquery.hammer.js
*/
(function(factory) {
  if (typeof define === 'function' && define.amd) {
    define(['jquery', 'hammerjs'], factory);
  } else if (typeof exports === 'object') {
    factory(require('jquery'), require('hammerjs'));
  } else {
    factory(jQuery, Hammer);
  }
}(function($, Hammer) {
  function hammerify(el, options) {
    var $el = $(el);
    if (!$el.data("hammer")) {
      $el.data("hammer", new Hammer($el[0], options));
    }
  }

  $.fn.hammer = function(options) {
    return this.each(function() {
      hammerify(this, options);
    });
  };

  // extend the emit method to also trigger jQuery events
  Hammer.Manager.prototype.emit = (function(originalEmit) {
    return function(type, data) {
      originalEmit.call(this, type, data);
      $(this.element).trigger({
        type: type,
        gesture: data
      });
    };
  })(Hammer.Manager.prototype.emit);
}));


/**!
 Swiper
 Swiper with items

 @contributors: Rodolphe (Alsacréations)
 @date-created: 2015-06-04
 @last-update: 2015-07-06
 */

(function($) {

  $.cxpSwiper = function(el, options) {

    var defaults = {
      activeIndex: 0, // active slide (group) index
      touch: true, // allow touch swiping
      touching: false, // is touch active
      touchDelta: 50, // touch swipe threshold
      animating: false, // is currently animated
      itemsPerSlide: undefined, // number of items per slide
      containerWidth: 0, // width of main container
      contentWidth: 0, // real width of content
      itemsCount: 0, // number of items
      slidesCount: 0, // number of pages
      autoDelay: false, // delay between slides
      paginateByItems: false, // show pagination by number of items (not by slide number)
      paginateByBullets: false, // activate bullets
      speed: 600, // transition speed (ms)
      loop: false, // loop transition
      orientationReset: false, // reset on orientationchange
      lastOrientation: -1, // last orientation value
      useActiveClasses: false, // use classes for active/inactive items (below)
      classActive: 'slider-item-active', // active HTML class, without dot
      classPrevious: 'slider-item-prev', // active HTML class, without dot
      classNext: 'slider-item-next', // active HTML class, without dot
      itemSelector: '.slider-item',
      wrapperSelector: '.swiper-wrapper',
      nextSelector: '.slider-btn-next',
      prevSelector: '.slider-btn-prev',
      playPauseSelector: '.slider-play-btn',
      pgStart: '.slider-nb-start',
      pgEnd: '.slider-nb-end',
      pgTotal: '.slider-nb-total',
      pgContainer: '.slider-pagin-nb',
      pgBulletElement: '<span class="slider-pagin-item"></span>',
      pgBulletActiveClass: 'is-active'
    };

    var plugin = this;

    plugin.settings = {};

    var $element = $(el),
      element = el;

    // Plugin initialization
    plugin.init = function() {

      plugin.settings = $.extend({}, defaults, options);
      updateSettingsFromHTMLData();
      registerEvents();

      // Values
      plugin.updateInitValues();
      plugin.updatePagination();

      if (plugin.settings.autoDelay > 0) {
        plugin.settings.isAutoplay = true;
        clearInterval(plugin.settings.interval);
        plugin.settings.interval = setInterval(plugin.swipeNext, plugin.settings.autoDelay);
      } else {
        plugin.settings.isAutoplay = false;
        clearInterval(plugin.settings.interval);
        $(plugin.settings.playPauseSelector, $element).hide();
      }

      // Initialize pagination
      if (plugin.settings.paginateByBullets) {
        for (var i = 0; i < plugin.settings.slidesCount; i++) {
          $(plugin.settings.pgContainer, $element).append(plugin.settings.pgBulletElement);
        }
        var $bullets = $(plugin.settings.pgContainer, $element).children();
        $bullets.first().addClass(plugin.settings.pgBulletActiveClass);
        $bullets.on('click', function() {
          plugin.swipePause();
          var decal = -(plugin.settings.activeIndex - $(this).index());
          if (decal !== 0) plugin.swipeTo(decal);
        });
      }

      // Initialize CSS transitions
      $(plugin.settings.wrapperSelector, $element).css({
        '-webkit-transition': 'all ' + (plugin.settings.speed / 1000) + 's',
        'transition': 'all ' + (plugin.settings.speed / 1000) + 's'
      });

      // Initialize touch events
      if (plugin.settings.touch) {
        $element.hammer().off('panright.cxpSwiper').on('panright.cxpSwiper', function(e) {
          if (!plugin.settings.touching && !plugin.settings.animating && e.gesture.deltaX > plugin.settings.touchDelta) {
            plugin.settings.touching = true;
            plugin.swipePrev();
          }
        });
        $element.hammer().off('panleft.cxpSwiper').on('panleft.cxpSwiper', function(e) {
          if (!plugin.settings.touching && !plugin.settings.animating && e.gesture.deltaX < -plugin.settings.touchDelta) {
            plugin.settings.touching = true;
            plugin.swipeNext();
          }
        });
        $element.hammer().off('panend.cxpSwiper').on('panend.cxpSwiper', function(e) {
          plugin.settings.touching = false;
        });

        // Go to first slide by default
        plugin.goTo(0);

      }

      // Orientation change ?
      plugin.settings.lastOrientation = ($(window).width() > $(window).height()) ? 90 : 0;

    };

    // Update dimensions values
    plugin.updateInitValues = function() {
      plugin.settings.itemsCount = $(plugin.settings.itemSelector, $element).length;
      plugin.settings.containerWidth = $(plugin.settings.wrapperSelector, $element).outerWidth();
      plugin.settings.contentWidth = 0;
      $(plugin.settings.itemSelector, $element).each(function() {
        plugin.settings.contentWidth += $(this).outerWidth();
      });
      if (plugin.settings.itemsPerSlide !== undefined) {
        plugin.settings.slidesCount = Math.ceil(plugin.settings.itemsCount / plugin.settings.itemsPerSlide);
      } else {
        plugin.settings.slidesCount = Math.ceil(plugin.settings.contentWidth / plugin.settings.containerWidth);
      }
    };

    // Reads plugin settings from HTML data-* attributes (camelCase)
    var updateSettingsFromHTMLData = function() {
      var data = $element.data();
      for (var dat in data) plugin.settings[dat] = data[dat];
    };

    // Event Handlers on HTML components inside the plugin
    var registerEvents = function() {

      $(plugin.settings.nextSelector, $element).off('click.cxpSwiper').on('click.cxpSwiper', function(e) {
        e.preventDefault();
        plugin.swipePause();
        plugin.swipeNext();
      });
      $(plugin.settings.prevSelector, $element).off('click.cxpSwiper').on('click.cxpSwiper', function(e) {
        e.preventDefault();
        plugin.swipePause();
        plugin.swipePrev();
      });
      $(plugin.settings.playPauseSelector, $element).off('click.cxpSwiper').on('click.cxpSwiper', function(e) {
        e.preventDefault();
        if (plugin.settings.isAutoplay) {
          plugin.swipePause();
        } else {
          plugin.swipePlay();
        }
      });

    };

    // Calculate offset of slides for swiping
    var getOffset = function(dir) {
      var offsetLeft = false;
      if (plugin.settings.itemsPerSlide === undefined) { // if itemsPerSlide is not defined : width is auto (container)
        offsetLeft = -plugin.settings.containerWidth * plugin.settings.activeIndex;
      } else { // if itemsPerSlide is defined
        var $items = $(plugin.settings.itemSelector, $element);
        var $item = $items.eq(plugin.settings.activeIndex * plugin.settings.itemsPerSlide);
        if ($item !== undefined && $item.length > 0) {
          offsetLeft = -($item.position().left);

          if (plugin.settings.useActiveClasses) {
            $items.removeClass(plugin.settings.classActive);
            $items.removeClass(plugin.settings.classNext);
            $items.removeClass(plugin.settings.classPrevious);
            $item.addClass(plugin.settings.classActive);
            $item.next().addClass(plugin.settings.classNext);
            $item.prev().addClass(plugin.settings.classPrevious);
          }

        }
      }
      if (offsetLeft === -0) offsetLeft = 0;
      return offsetLeft;
    };

    // Toggle pause state
    plugin.swipePause = function() {
      $(plugin.settings.playPauseSelector, $element).find('.icon').removeClass('icon-pause').addClass('icon-play');
      clearInterval(plugin.settings.interval);
      plugin.settings.isAutoplay = false;
    };

    // Toggle auto play state
    plugin.swipePlay = function() {
      $(plugin.settings.playPauseSelector, $element).find('.icon').removeClass('icon-play').addClass('icon-pause');
      clearInterval(plugin.settings.interval);
      plugin.settings.interval = setInterval(plugin.swipeNext, plugin.settings.autoDelay);
      plugin.settings.isAutoplay = true;
    };

    // Destroy
    plugin.destroy = function() {
      // Clear the autoplay interval if exists
      clearInterval(plugin.settings.interval);
      // Unregister events
      $(plugin.settings.prevSelector + ',' + plugin.settings.nextSelector, $element).off('.cxpSwiper');
      // Autodestroy
      $element.removeData('cxpSwiper');
    };

    // Next item
    plugin.swipeNext = function() {
      plugin.swipeTo(1);
    };

    // Previous item
    plugin.swipePrev = function() {
      plugin.swipeTo(-1);
    };

    // Go to item (direct)
    plugin.goTo = function(index) {
      if (index > -1) plugin.settings.activeIndex = index;
      var offsetLeft = getOffset(index);
      $(plugin.settings.wrapperSelector, $element).css({
        '-webkit-transform': 'translate3d(' + offsetLeft + 'px,0,0)',
        'transform': 'translate3d(' + offsetLeft + 'px,0,0)'
      });
      plugin.updatePagination();
    };

    // Swipe to item
    plugin.swipeTo = function(dir) {

      if (plugin.settings.animating) return false;

      // If looping : rewinds to first slide
      if (plugin.settings.loop && plugin.settings.activeIndex + dir >= plugin.settings.slidesCount) {
        plugin.goTo(0);
        return;
        // dir = -plugin.settings.activeIndex; to go back with animation
      }

      // If forward/backgards direction is ok
      if (plugin.settings.activeIndex + dir >= 0 && plugin.settings.activeIndex + dir < plugin.settings.slidesCount) {
        plugin.settings.animating = true;
        clearInterval(plugin.settings.interval);
        if (plugin.settings.isAutoplay) plugin.settings.interval = setInterval(plugin.swipeNext, plugin.settings.autoDelay);
        plugin.settings.activeIndex += dir;
        var offsetLeft = getOffset(dir);
        if (offsetLeft !== false) {
          /*$(plugin.settings.wrapperSelector, $element).animate({
            left: offsetLeft + 'px'
          },plugin.settings.speed,'swing', function() {
            plugin.settings.animating = false;
          });*/
          $(plugin.settings.wrapperSelector, $element).css({
            '-webkit-transform': 'translate3d(' + offsetLeft + 'px,0,0)',
            'transform': 'translate3d(' + offsetLeft + 'px,0,0)'
          });

          setTimeout(function() {
            plugin.settings.animating = false;
          }, plugin.settings.speed);
        } else {
          plugin.settings.animating = false;
          plugin.settings.activeIndex -= dir;
        }
        plugin.updatePagination();
      }

    };

    // Update on resize
    plugin.updateResize = function() {

      if (plugin.settings.orientationReset) {
        var screenOrientation = ($(window).width() > $(window).height()) ? 90 : 0;
        if (screenOrientation !== plugin.settings.lastOrientation) {
          plugin.settings.lastOrientation = screenOrientation;
          plugin.init();
        }
      }
      // Fix on resize
      plugin.goTo(plugin.settings.activeIndex);
    };

    // Update pagination
    plugin.updatePagination = function() {

      //if(plugin.settings.activeIndex===0) return false;
      var $next = $(plugin.settings.nextSelector, $element);
      var $prev = $(plugin.settings.prevSelector, $element);

      if (plugin.settings.paginateByBullets) { // Paginate by bullets

        // Update HTML elements (bullets)
        $(plugin.settings.pgContainer, $element).children().removeClass(plugin.settings.pgBulletActiveClass).eq(plugin.settings.activeIndex).addClass(plugin.settings.pgBulletActiveClass);
        $next.css({
          opacity: (plugin.settings.activeIndex + 1 < plugin.settings.slidesCount ? 1 : 0)
        });
        $prev.css({
          opacity: (plugin.settings.activeIndex > 0 ? 1 : 0)
        });

      }

      if (plugin.settings.paginateByItems && plugin.settings.itemsPerSlide) { // Group pagination (start-end/total)

        var start = plugin.settings.activeIndex * plugin.settings.itemsPerSlide + 1;
        var end = Math.min(plugin.settings.activeIndex * plugin.settings.itemsPerSlide + plugin.settings.itemsPerSlide, plugin.settings.itemsCount);
        $(plugin.settings.pgStart, $element).text(start);
        if (end != start && end > start) $(plugin.settings.pgEnd, $element).text('-' + end);
        else $(plugin.settings.pgEnd, $element).text('');
        $(plugin.settings.pgTotal, $element).text(plugin.settings.itemsCount);
        $next.css({
          opacity: (end < plugin.settings.itemsCount ? 1 : 0)
        });
        $prev.css({
          opacity: (start > 1 ? 1 : 0)
        });

      } else { // Classic pagination (n/total)

        $(plugin.settings.pgStart, $element).text(plugin.settings.activeIndex + 1);
        $(plugin.settings.pgTotal, $element).text(plugin.settings.slidesCount);
        $next.css({
          opacity: (plugin.settings.activeIndex + 1 < plugin.settings.slidesCount ? 1 : 0)
        });
        $prev.css({
          opacity: (plugin.settings.activeIndex > 0 ? 1 : 0)
        });

      }

    };

    plugin.init();
    $(window).on('resize.cxpSwiper', plugin.updateResize);

  };

  $.fn.cxpSwiper = function(options) {

    return this.each(function() {
      if (undefined === $(this).data('cxpSwiper')) {
        var plugin = new $.cxpSwiper(this, options);
        $(this).data('cxpSwiper', plugin);
      }
    });

  };

  $('.cxp-swiper').cxpSwiper();

})(jQuery);

/**!
 Tab Nav
 Description du module

 @contributors: Guillaume Focheux (Alsacréations)
 @date-created: 2015-04-24
 @last-update: 2015-04-24
 */

;
(function ($) {

    if ($('.tabs-nav').length > 0) {
	$AllTabNav = $('.tabs-nav');
	$AllTabNav.find('.tn-item-link').on('click', function (e) {
	    e.preventDefault();
	    var indexTab = $(this).closest('.tn-item').index(),
		$tabNav = $(this).closest('.tabs-nav');
	    $('.tn-item-link', $tabNav).removeClass('is-active');
	    $(this).addClass('is-active');
	    $('.tn-panel', $tabNav).removeClass('is-visible');
	    $('.tn-panel', $tabNav).eq(indexTab).addClass('is-visible');
	    if ($('.tn-panel', $tabNav).eq(indexTab).find('.slider').length > 0) {
		// Reset the slider in the hidden tab
//		$('.tn-panel', $tabNav).eq(indexTab).find('.slider').each(function (e) {
//		    var sliderClass = $(this).attr("class").match(/slider-instance[\w-]*\b/);
//		    sliderClass = sliderClass[0];
//		});
	    }
	});
    }

})(jQuery);
/**!
 Visual Navigation
 Dropdown menu & Mega menu navigation

 @contributors: Guillaume Focheux (Alsacréations), Geoffrey Crofte (Alsacréations), Rodolphe (Alsacréations)
 @date-created: 2015-04-10
 @last-update: 2015-06-01
 */

;
(function($) {

  // Variables
  var $burger = $('.sb-menu-trigger'),
    $mainNav = $('.main-navigation'),
    $closeNav = $('.mn-menu-toclose'),
    $linkInMenu = $('>ul>li.mn-menu-item', $mainNav),
    $headerline = $('.site-banner'),
    menuInitPos = $headerline.outerHeight(), //gc
    scrolltimer; // gc

  // Open navigation
  $burger.on('click', function(e) {
    $mainNav.addClass('mn-visible');
    $('#overlay').addClass('is-open');
  });

  // Close navigation
  $closeNav.on('click', function(e) {
    $mainNav.removeClass('mn-visible');
    // Reset other is-open
    $linkInMenu.removeClass('is-open');
    $('#overlay').removeClass('is-open');
  });

  // Hide/show submenus with pointer
  $linkInMenu.on('click mouseenter', function(e) {
    $('li', $mainNav).removeClass('is-open');
    if ($(this).hasClass('mn-item-has-submenu')) {
      $(this).addClass('is-open');
    }
    $(this).parent('.mn-menu-lvl1').addClass('submenu-is-open');
  });

  // Open navigation when clicking outside (on the overlay)
  $('#overlay').on('click', function() {
    $closeNav.trigger('click');
  });

  // Sticky things on scroll (gc)
  window.addEventListener('scroll', function() {
    clearTimeout(scrolltimer);
    scrolltimer = setTimeout(function() {

      if ($(window).scrollTop() >= menuInitPos) {
        $headerline.addClass('is-stuck');
      } else {
        $headerline.removeClass('is-stuck');
      }

    }, 15);
  }, true);

})(jQuery);
